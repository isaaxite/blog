!function(n){n.Callbacks=function(e){e=n.extend({},e);var t,r,i,o,s,u,a=[],c=!e.once&&[],f=function(n){for(t=e.memory&&n,r=!0,u=o||0,o=0,s=a.length,i=!0;a&&s>u;++u)if(a[u].apply(n[0],n[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,a&&(c?c.length&&f(c.shift()):t?a.length=0:l.disable())},l={add:function(){if(a){var r=a.length,u=function(t){n.each(t,function(n,t){"function"==typeof t?e.unique&&l.has(t)||a.push(t):t&&t.length&&"string"!=typeof t&&u(t)})};u(arguments),i?s=a.length:t&&(o=r,f(t))}return this},remove:function(){return a&&n.each(arguments,function(e,t){for(var r;(r=n.inArray(t,a,r))>-1;)a.splice(r,1),i&&(s>=r&&--s,u>=r&&--u)}),this},has:function(e){return!(!a||!(e?n.inArray(e,a)>-1:a.length))},empty:function(){return s=a.length=0,this},disable:function(){return a=c=t=void 0,this},disabled:function(){return!a},lock:function(){return c=void 0,t||l.disable(),this},locked:function(){return!c},fireWith:function(n,e){return!a||r&&!c||(e=e||[],e=[n,e.slice?e.slice():e],i?c.push(e):f(e)),this},fire:function(){return l.fireWith(this,arguments)},fired:function(){return!!r}};return l}}(Zepto),function(n){function e(t){var r=[["resolve","done",n.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",n.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",n.Callbacks({memory:1})]],i="pending",o={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var t=arguments;return e(function(e){n.each(r,function(r,i){var u=n.isFunction(t[r])&&t[r];s[i[1]](function(){var t=u&&u.apply(this,arguments);if(t&&n.isFunction(t.promise))t.promise().done(e.resolve).fail(e.reject).progress(e.notify);else{var r=this===o?e.promise():this,s=u?[t]:arguments;e[i[0]+"With"](r,s)}})}),t=null}).promise()},promise:function(e){return null!=e?n.extend(e,o):o}},s={};return n.each(r,function(n,e){var t=e[2],u=e[3];o[e[1]]=t.add,u&&t.add(function(){i=u},r[1^n][2].disable,r[2][2].lock),s[e[0]]=function(){return s[e[0]+"With"](this===s?o:this,arguments),this},s[e[0]+"With"]=t.fireWith}),o.promise(s),t&&t.call(s,s),s}var t=Array.prototype.slice;n.when=function(r){var i,o,s,u=t.call(arguments),a=u.length,c=0,f=1!==a||r&&n.isFunction(r.promise)?a:0,l=1===f?r:e(),h=function(n,e,r){return function(o){e[n]=this,r[n]=arguments.length>1?t.call(arguments):o,r===i?l.notifyWith(e,r):--f||l.resolveWith(e,r)}};if(a>1)for(i=new Array(a),o=new Array(a),s=new Array(a);a>c;++c)u[c]&&n.isFunction(u[c].promise)?u[c].promise().done(h(c,s,u)).fail(l.reject).progress(h(c,o,i)):--f;return f||l.resolveWith(s,u),l.promise()},n.Deferred=e}(Zepto);