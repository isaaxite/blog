<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png"><link rel="mask-icon" href="/blog/images/logo.svg" color="#222"><meta name="google-site-verification" content="D3uaiX9T8gcr1zBjqu9y67t-0DhGNCa7yyjpQ27T_Co"><meta name="msvalidate.01" content="AFD16F68B2DF363759600CB5E8825AEC"><link rel="stylesheet" href="/blog/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"isaaxite.github.io","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":false,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/blog/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog/js/config.js"></script><meta name="description" content="前言最近在开发使用 Github Issue 编写 blog 的项目。目前还在持续开发中，已经 300+ commits，npm 上已经发布的版本迭代有 9个。后面仍然会继续维护，有许多准备增加的能供，需要优化的点，以及已知的需要重构的逻辑，应该还会有相当的bug需要修复。 抱着负责任的态度，个人认为需要一个渠道使得 Isubo 的使用者获知这些一系列的变动。因此，需要编写 CHANGELOG 记"><meta property="og:type" content="article"><meta property="og:title" content="自动化CHANGELOG，持续集成"><meta property="og:url" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/index.html"><meta property="og:site_name" content="Isaac Kam&#39;s Blog"><meta property="og:description" content="前言最近在开发使用 Github Issue 编写 blog 的项目。目前还在持续开发中，已经 300+ commits，npm 上已经发布的版本迭代有 9个。后面仍然会继续维护，有许多准备增加的能供，需要优化的点，以及已知的需要重构的逻辑，应该还会有相当的bug需要修复。 抱着负责任的态度，个人认为需要一个渠道使得 Isubo 的使用者获知这些一系列的变动。因此，需要编写 CHANGELOG 记"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/test_commitlint.gif"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/commitlint_by_hook.gif"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/test_prompt-cli.gif"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/Snipaste_2023-07-25_18-24-32.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/Snipaste_2023-07-25_18-23-41.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/Snipaste_2023-07-26_11-28-57.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/Snipaste_2023-07-26_21-57-36.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/Snipaste_2023-07-27_04-51-22.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/Snipaste_2023-07-26_20-14-55.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/Snipaste_2023-07-26_11-57-45.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/Snipaste_2023-08-07_00-58-17.png"><meta property="article:published_time" content="2023-07-13T03:06:20.000Z"><meta property="article:modified_time" content="2025-03-07T23:26:45.780Z"><meta property="article:author" content="Isaac Kam"><meta property="article:tag" content="CHANGELOG"><meta property="article:tag" content="自动化"><meta property="article:tag" content="Commit规范"><meta property="article:tag" content="版本控制"><meta property="article:tag" content="Git Hook"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/test_commitlint.gif"><link rel="canonical" href="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/","path":"resources/Automated-Changelog-Manual/","title":"自动化CHANGELOG，持续集成"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>自动化CHANGELOG，持续集成 | Isaac Kam's Blog</title><noscript><link rel="stylesheet" href="/blog/css/noscript.css"></noscript><link rel="alternate" href="/blog/atom.xml" title="Isaac Kam's Blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/blog/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Isaac Kam's Blog</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">I am a slow walker, but I never walk backwards.</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/blog/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li><li class="menu-item menu-item-rss"><a href="/blog/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E7%9A%84%E4%BC%98%E7%82%B9"><span class="nav-text">自动化的优点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CHANGELOG-%E7%9A%84%E9%A2%84%E6%9C%9F"><span class="nav-text">CHANGELOG 的预期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%80%9D%E8%B7%AF"><span class="nav-text">自动化思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81"><span class="nav-text">工作流</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Git-Commit-%E8%A7%84%E8%8C%83"><span class="nav-text">Git Commit 规范</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Angular-%E8%A7%84%E8%8C%83"><span class="nav-text">Angular 规范</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Conventional-Commits-%E8%A7%84%E8%8C%83"><span class="nav-text">Conventional Commits 规范</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gitmoji-%E8%A7%84%E8%8C%83"><span class="nav-text">Gitmoji 规范</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Commit-%E8%AF%AD%E6%B3%95%E6%A3%80%E6%B5%8B"><span class="nav-text">Commit 语法检测</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Husky"><span class="nav-text">安装 Husky</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Commitlint"><span class="nav-text">安装 Commitlint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Husky-Commitlint"><span class="nav-text">Husky + Commitlint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8A%E8%87%AA%E5%8A%A8%E7%BC%96%E5%86%99-Commit"><span class="nav-text">半自动编写 Commit</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="nav-text">版本管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90"><span class="nav-text">例子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Npm-Version%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">Npm-Version生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-1"><span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Standard-Version%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-text">Standard-Version的生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="nav-text">小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#CHANGELOG%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="nav-text">CHANGELOG自动化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#conventional-changelog-cli"><span class="nav-text">conventional-changelog-cli</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-text">使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preset"><span class="nav-text">preset</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-3"><span class="nav-text">小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Standard-Version"><span class="nav-text">Standard Version</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="nav-text">使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-1"><span class="nav-text">配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81-1"><span class="nav-text">工作流</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%99%84%E5%BD%95"><span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Husky%E6%94%AF%E6%8C%81%E7%9A%84-Git-hook"><span class="nav-text">Husky支持的 Git hook</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#post-merge-%E9%92%A9%E5%AD%90%E8%A7%A6%E5%8F%91prompt%E5%A4%B1%E8%B4%A5"><span class="nav-text">post-merge 钩子触发prompt失败</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-text">参考</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Isaac Kam" src="/blog/images/avatar.jpg"><p class="site-author-name" itemprop="name">Isaac Kam</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/blog/archives/"><span class="site-state-item-count">64</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/blog/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/blog/tags/"><span class="site-state-item-count">92</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/isaaxite" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;isaaxite" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="isaacgun:isaacgun@outlook.com" title="E-Mail → isaacgun:isaacgun@outlook.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/blog/images/avatar.jpg"><meta itemprop="name" content="Isaac Kam"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Isaac Kam's Blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="自动化CHANGELOG，持续集成 | Isaac Kam's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">自动化CHANGELOG，持续集成</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-07-13 11:06:20" itemprop="dateCreated datePublished" datetime="2023-07-13T11:06:20+08:00">2023-07-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-03-08 07:26:45" itemprop="dateModified" datetime="2025-03-08T07:26:45+08:00">2025-03-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/blog/categories/CI-CD/" itemprop="url" rel="index"><span itemprop="name">CI/CD</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/blog/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" itemprop="url" rel="index"><span itemprop="name">持续集成</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/blog/categories/npm/" itemprop="url" rel="index"><span itemprop="name">npm</span></a></span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在开发使用 Github Issue 编写 blog 的项目。目前还在持续开发中，已经 300+ commits，npm 上已经发布的版本迭代有 9个。后面仍然会继续维护，有许多准备增加的能供，需要优化的点，以及已知的需要重构的逻辑，应该还会有相当的bug需要修复。</p><p>抱着负责任的态度，个人认为需要一个渠道使得 Isubo 的使用者获知这些一系列的变动。因此，需要编写 CHANGELOG 记录每个项目版本的变动。</p><p>但是，由于目前还是一个人在开发此项目，精力有限，需要更多地聚焦在功能新增、优化、重构和Bug修复。</p><p><em>CHANGELOG 自动化是最终的答案！</em></p><span id="more"></span><h2 id="自动化的优点"><a href="#自动化的优点" class="headerlink" title="自动化的优点"></a>自动化的优点</h2><ul><li><p><strong>简化了 changelog 的创建流程</strong>：手动创建 changelog 可能需要花费大量的时间和精力，特别是对于大型项目来说。自动化创建 changelog 可以减少这种繁琐的工作，允许开发者更专注于编写代码和解决问题。</p></li><li><p><strong>提高了 changelog 的准确性</strong>：手动创建 changelog 可能会出现遗漏或错误，因为开发者需要手动记录每个版本的更改。自动化创建 changelog 可以消除这些错误，因为它们会自动从版本控制系统中提取信息。</p></li><li><p><strong>帮助团队更好地协作</strong>：自动化创建 changelog 可以帮助团队更好地协作和沟通。开发者可以更轻松地了解项目的演变历史和当前状态，从而更好地协调和分配任务。</p></li><li><p><strong>提高了项目的可维护性</strong>：自动化创建 changelog 可以提高项目的可维护性。由于 changelog 可以自动生成，因此开发者可以更容易地了解每个版本的更改，从而更好地维护和更新代码。</p></li></ul><p>总之，自动化创建 changelog 可以提高项目的开发效率、降低错误率、加强团队协作，从而提高项目的可维护性和稳定性。</p><h2 id="CHANGELOG-的预期"><a href="#CHANGELOG-的预期" class="headerlink" title="CHANGELOG 的预期"></a>CHANGELOG 的预期</h2><p>页面是列表的结构，列表的子项是版本变动说明。下面是子项的结构：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 标题</span><br><span class="line"><span class="section"># 版本号-1</span></span><br><span class="line"></span><br><span class="line">// 内容</span><br><span class="line"><span class="bullet">-</span> 新增的功能 1</span><br><span class="line"><span class="bullet">-</span> 修复的bug</span><br><span class="line"><span class="bullet">-</span> 优化</span><br><span class="line"><span class="bullet">-</span> ...</span><br></pre></td></tr></table></figure><p>主要由标题和内容两部分构成：</p><ul><li>标题：版本号</li><li>内容：子列表描述变动，包含但不限于功能新增、Bug修复等等</li></ul><h2 id="自动化思路"><a href="#自动化思路" class="headerlink" title="自动化思路"></a>自动化思路</h2><p><strong>1. Commits 规范</strong></p><p>所谓巧妇难为无米之炊，所以得先有“米”才有 CHANGELOG，这里的“米”就是commits。</p><p>既然要描述新增的功能、修复的bug 和 优化等不同类型的实现，那些就要让这些实现对应的 commits 符合规范。</p><p>因此，第一步是了解现有那些 commits 的规范。选择需要遵循的规范或者基于它们指定符合预期的规范。</p><p><em>下面将分别详细介绍：Angular规范、Conventional Commits规范 和 Gitmoji规范。</em></p><p><strong>2. 约束 Commit 编写</strong></p><p>既有规范，则需要有 commit msg 的校验逻辑。使用 <code>git-hooks</code> 钩子拦截开发者输入的 commit msg，然后对其进行校验，打回或通过后提交commit到 <code>git-log</code>。</p><p><em>下文将使用 husky 拦截 <code>commit-msg</code> 钩子，然后使用 <code>Commitlint</code> 校验。</em></p><p><strong>3. 优化 Commit 编写</strong></p><p>校验终归是校验而已。如果对所遵循的规范不熟悉，编写格式正确的 commit 存在一定的心智成本。或许该增加辅助工具降低心智成本，无需数值规范，按着步骤输入即可。</p><p><em>下文将分别介绍 2 款 prompt 工具辅助commit的编写，它们分别是 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@commitlint/prompt-cli">@commitlint&#x2F;prompt-cli ↗</a> 和 <a href="cz-cli">Commitizen ↗</a>。</em></p><p><strong>4. 版本管理</strong></p><p>CHANGELOG 的生成节点是版本的创建。由创建版本这个行为，产生 CHANGELOG 这个结果，因此得先处理如何进行版本管理这个问题。</p><p>制定合理的版本管理策略前，同样需要了解现有的版本管理规范，在前人路上汲取养分。同样是需要工具去约束，以版本创建的结果符合规范。</p><p><em>下文将介绍SemVer规范，版本管理工具 <code>npm-version</code> 和 <code>standard-version</code>。包含2个工具的使用和各自工作的生命周期</em></p><p><strong>5. CHANGELOG自动化</strong></p><p>结合前面提到的 2 个版本管理工具，利用它们各自的生命周期，适时触发 CHANGELOG 的生成。</p><p><code>standard-version</code> 的功能不限于版本管理，还兼具 CHANGELOG 的生成。以及与 <code>standard-version</code> 来自同一个工具集的 <code>conventional-changelog-cli</code>。2 个都是比较常用的工具。</p><p><em>下文将 <a href="#CHANGELOG%E8%87%AA%E5%8A%A8%E5%8C%96">CHANGELOG自动化</a> 详细价绍它们的安装、使用、配置。</em></p><h2 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h2><p><em>1. 基于 main 分支创建 develop 分支（feat&#x2F;xxx、fix&#x2F;xxx、…）；</em></p><p><em>2. commit 变动；</em></p><p><em>3. develop 分支内容开发完成，push分支；</em></p><p><em>4. 合并 develop 分支，触发 <code>post-merge</code> Git 钩子；</em></p><p><em>5. 创建版本、创建 git-tag 和生成 CHANGELOG</em></p><p><em>6. 发布 git-tag 和 CHANGELOG 变动、build 源码并发布至 npm</em></p><h1 id="Git-Commit-规范"><a href="#Git-Commit-规范" class="headerlink" title="Git Commit 规范"></a>Git Commit 规范</h1><p>首先要解决的问题是</p><table><thead><tr><th>规范名称</th><th>描述</th></tr></thead><tbody><tr><td><a target="_blank" rel="noopener" href="https://github.com/angular/angular/blob/master/CONTRIBUTING.md#commit">Angular规范 ↗</a></td><td>Angular规范是非常流行的Git Commit规范之一，拥有众多的用户和贡献者。它提供了一套完整的Git Commit规范。Angular规范要求Commit message必须包含三个部分：类型、范围和描述。类型可以是feat、fix、docs、style、refactor、test、chore等。范围是可选的，用于表示代码变更的影响范围。描述应该清晰地描述代码变更的内容。</td></tr><tr><td><a target="_blank" rel="noopener" href="https://www.conventionalcommits.org/">Conventional Commits规范 ↗</a></td><td>Conventional Commits是一种通用的Git Commit规范，它要求Commit message必须包含三个部分：类型、作用域和描述。类型可以是feat、fix、docs、style、refactor、test、build等。作用域是可选的，用于表示代码变更的影响范围。描述应该清晰地描述代码变更的内容。Conventional Commits还支持关键词，用于表示代码变更的重要性，例如：BREAKING CHANGE表示这个Commit会破坏向后兼容性。</td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/carloscuesta/gitmoji">Gitmoji规范 ↗</a></td><td>Gitmoji是一种基于Emoji表情符号的Git Commit规范，它要求Commit message必须包含一个Emoji表情符号，用于表示代码变更的类型。例如：:sparkles:表示新增功能，:bug:表示修复Bug，:pencil2:表示修改文档等等。Gitmoji规范还支持在Emoji后面添加一个简短的描述，用于更详细地描述代码变更的内容。</td></tr></tbody></table><p>下面是每种规范的格式的列表：</p><h2 id="Angular-规范"><a href="#Angular-规范" class="headerlink" title="Angular 规范"></a>Angular 规范</h2><p>Angular 规范要求每个 commit message 都包含三个部分：Header、Body 和 Footer。其中，Header 包含一个必填字段和一个可选字段，必填字段为 Type，可选字段为 Scope。Body 和 Footer 都是可选的，用于提供更详细的信息。</p><p><strong>Type 字段包含以下值：</strong></p><ul><li><code>feat</code>：新功能</li><li><code>fix</code>：修复问题</li><li><code>docs</code>：文档修改</li><li><code>style</code>：代码格式修改，不影响代码逻辑</li><li><code>refactor</code>：重构代码，既不修复错误也不添加功能</li><li><code>perf</code>：性能优化</li><li><code>test</code>：添加或修改测试代码</li><li><code>build</code>：构建系统或外部依赖项修改</li><li><code>ci</code>：持续集成修改</li><li><code>chore</code>：其他修改，如修改构建流程或辅助工具等</li><li><code>revert</code>：回滚到之前的提交</li></ul><p><strong>Angular 规范的格式为：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;type&gt;[(scope)]: &lt;subject&gt;</span><br><span class="line"></span><br><span class="line">[body]</span><br><span class="line"></span><br><span class="line">[footer]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">e.g.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">slim</span></span><br><span class="line">feat: add user management module</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fully</span></span><br><span class="line">feat(users): add user management module</span><br><span class="line"></span><br><span class="line">This commit adds the user management module to the project.</span><br><span class="line"></span><br><span class="line">Closes #123</span><br></pre></td></tr></table></figure><p>其中，<code>&lt;type&gt;</code> 表示 commit 的类型，<code>[scope]</code> 表示 commit 的影响范围，<code>&lt;subject&gt;</code> 表示 commit 的简短描述，<code>[body]</code> 表示 commit 的详细描述，<code>&lt;footer&gt;</code> 表示 commit 的元信息，如关闭 issue、引入变更等。</p><h2 id="Conventional-Commits-规范"><a href="#Conventional-Commits-规范" class="headerlink" title="Conventional Commits 规范"></a>Conventional Commits 规范</h2><p>Conventional Commits 规范要求每个 commit message 都包含三个部分：Type、Scope 和 Subject。其中，Type 和 Subject 是必填的，Scope 是可选的。</p><p><strong>Type 包含以下值：</strong></p><ul><li><code>feat</code>：新功能</li><li><code>fix</code>：修复问题</li><li><code>docs</code>：文档修改</li><li><code>style</code>：代码格式修改，不影响代码逻辑</li><li><code>refactor</code>：重构代码，既不修复错误也不添加功能</li><li><code>perf</code>：性能优化</li><li><code>test</code>：添加或修改测试代码</li><li><code>build</code>：构建系统或外部依赖项修改</li><li><code>ci</code>：持续集成修改</li><li><code>chore</code>：其他修改，如修改构建流程或辅助工具等</li><li><code>revert</code>：回滚到之前的提交</li><li><code>feat!</code>: 不兼容的新功能</li><li><code>fix!</code>: 不兼容的修复问题</li><li><code>docs!</code>: 不兼容的文档修改</li><li><code>style!</code>: 不兼容的代码格式修改</li><li><code>refactor!</code>: 不兼容的重构代码</li><li><code>perf!</code>: 不兼容的性能优化</li><li><code>test!</code>: 不兼容的添加或修改测试代码</li><li><code>build!</code>: 不兼容的构建系统或外部依赖项修改</li><li><code>ci!</code>: 不兼容的持续集成修改</li><li><code>chore!</code>: 不兼容的其他修改，如修改构建流程或辅助工具等</li></ul><p><strong>Conventional Commits 规范的格式为：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;type&gt;[scope]: &lt;subject&gt;</span><br><span class="line"></span><br><span class="line">[body]</span><br><span class="line"></span><br><span class="line">[footer]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">e.g.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">slim</span></span><br><span class="line">feat: add user management module</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fully</span></span><br><span class="line">feat(users): add user management module</span><br><span class="line"></span><br><span class="line">This commit adds the user management module to the project.</span><br><span class="line"></span><br><span class="line">Closes #123</span><br></pre></td></tr></table></figure><p>其中，<code>&lt;type&gt;</code> 表示 commit 的类型，<code>[scope]</code> 表示 commit 的影响范围，<code>&lt;subject&gt;</code> 表示 commit 的简短描述，<code>[body]</code> 表示 commit 的详细描述，<code>[footer]</code> 表示 commit 的元信息。</p><h2 id="Gitmoji-规范"><a href="#Gitmoji-规范" class="headerlink" title="Gitmoji 规范"></a>Gitmoji 规范</h2><p>以下是 Gitmoji 规范中一些常用的 emoji 和它们的含义：</p><ul><li>✨ <code>:sparkles:</code>：新增功能</li><li>🐛 <code>:bug:</code>：修复 bug</li><li>📚 <code>:books:</code>：修改文档</li><li>💄 <code>:lipstick:</code>：修改样式</li><li>♻️ <code>:recycle:</code>：重构代码。</li><li>✅ <code>:white_check_mark:</code>：修改测试用例</li><li>🔧 <code>:wrench:</code>：修改构建过程或工具</li><li>🚀 <code>:rocket:</code>：优化性能</li><li>💚 <code>:green_heart:</code>：修改持续集成流程</li><li>📦 <code>:package:</code>：修改构建过程</li><li>⏪ <code>:rewind:</code>：撤销之前的提交</li></ul><p>Gitmoji 规范的格式为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;gitmoji&gt; &lt;description&gt;</span><br><span class="line"></span><br><span class="line">[body]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">e.g.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">slim</span></span><br><span class="line">✨ add user management module</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">fully</span></span><br><span class="line">✨ add user management module</span><br><span class="line"></span><br><span class="line">This commit adds the user management module to the project.</span><br></pre></td></tr></table></figure><p>其中，<code>&lt;gitmoji&gt;</code> 是一个表情符号，表示 commit 的类型和含义，<code>&lt;description&gt;</code> 表示 commit 的简短描述 ,<code>[body]</code>?: commit 的详细描述。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>从以上可以看出 Conventional Commits 规范 与 Angular 规范有比较多的相同之处。是的，Conventional Commits 规范借鉴了 Angular 规范。</p><p>事实上，Conventional Commits 规范的创始人 Tim Pope 是 Karma 团队的成员，他在开发 Karma 过程中使用了 Angular 规范，认为这个规范非常有用。因此，他在 Angular 规范的基础上，扩充和修改了一些内容，提出了 Conventional Commits 规范。可以说，Conventional Commits 规范是在 Angular 规范的基础上发展而来的，但是相对于 Angular 规范，Conventional Commits 规范更加通用，可以适用于更多的项目和开发语言。</p><p><em>以下是 Angular 规范和 Conventional Commits 规范在某些方面存在的一些差异，具体如下：</em></p><ul><li><p><strong>Header 格式不同</strong>：Angular 规范要求 Header 必须包含 Type 字段和可选的 Scope 字段，如 “feat(core): add new feature”；而 Conventional Commits 规范要求 Header 必须包含 Type 和 Subject 字段，Scope 字段是可选的，如 “feat: add new feature”。</p></li><li><p><strong>Type 值的定义略有不同</strong>：Angular 规范和 Conventional Commits 规范都定义了一些 Type 值，但有些值的含义略有不同。例如，Conventional Commits 规范将 “build” 和 “ci” 两个 Type 值分别定义为构建和持续集成修改，而 Angular 规范将它们合并为 “build”。</p></li><li><p><strong>Conventional Commits 规范定义了特殊的 Type 值</strong>：Conventional Commits 规范定义了一些特殊的 Type 值，如 “feat!” 和 “fix!”，用于表示不兼容的新功能或修复问题。而 Angular 规范没有这样的定义。</p></li></ul><p>Gitmoji 规范的显著特点是供了大量的 emoji 来描述不同类型和目的的 Git 提交，这使得开发者可以更加准确地描述自己的 Git 提交，简单易懂，具有很强的可读性。Commit的格式在一定程度上与前两者有相似之处，从提出时间上看，它算是采百家之长的集大成者了。</p><p>Gitmoji 规范的制定者 Carlos Cuesta 在规范的 Github 页面上并没有明确提到他借鉴了哪些规范。然而，从 Gitmoji 规范的内容来看，它借鉴了一些其他的规范和标准，例如：</p><ul><li><p><strong>Emoji</strong>：Gitmoji 规范使用 Emoji 表情符号来表示不同类型的提交，这一做法和 Slack、微信等工具中使用 Emoji 表情符号的方式类似。</p></li><li><p><strong>Semantic Versioning</strong>：Gitmoji 规范中使用了类似 Semantic Versioning 的方式来表示版本，例如 “:bookmark:” 表示打标签，”:bookmark: v1.0.0” 表示打了一个 v1.0.0 的标签。</p></li><li><p><strong>Conventional Commits</strong>：Gitmoji 规范和 Conventional Commits 规范类似，都是使用 commit message 来描述代码库的变化。不过，Gitmoji 规范使用 Emoji 表情符号来表示不同类型的提交，而 Conventional Commits 规范使用文本标识符来表示。</p></li></ul><h1 id="Commit-语法检测"><a href="#Commit-语法检测" class="headerlink" title="Commit 语法检测"></a>Commit 语法检测</h1><p><a target="_blank" rel="noopener" href="https://commitlint.js.org/#/?id=getting-started">Commitlint ↗</a> 是一个用于检查 commit message 是否符合规范的工具，可以自定义规则和配置。它支持多种规范，如 Angular 规范、Conventional Commits 规范、ESLint 规范等。</p><p><a target="_blank" rel="noopener" href="https://commitlint.js.org/#/?id=getting-started">Commitlint ↗</a> 的作用仅仅是检测 Commit 语法。还需要使用 Git Hook （<code>commit-msg</code>）拦截 <code>git commit</code> 动作以达到强制执行规范的目的。</p><blockquote><p><strong>commit-msg</strong><br>This hook is invoked by <a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-commit">git-commit[1]</a> and <a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-merge">git-merge[1]</a>, and can be bypassed with the <code>--no-verify</code> option. It takes a single parameter, the name of the file that holds the proposed commit log message. Exiting with a non-zero status causes the command to abort.</p><p><mark>The hook is allowed to edit the message file in place, and can be used to normalize the message into some project standard format. It can also be used to refuse the commit after inspecting the message file.</mark></p><p>The default commit-msg hook, when enabled, detects duplicate <code>Signed-off-by</code> trailers, and aborts the commit if one is found.</p><p>Refenrence: <a target="_blank" rel="noopener" href="https://git-scm.com/docs/githooks#_commit_msg">githooks - Hooks used by Git</a></p></blockquote><p><a target="_blank" rel="noopener" href="https://typicode.github.io/husky/">Husky ↗</a> 是一个 Git hook 工具，它可以在 Git 执行特定操作时自动触发预定义的脚本。常用于配合 Commitlint 进行 commit message 的校验。与原生的 Git hook 相比，Husky 有以下优点：</p><ul><li><p><strong>易于使用</strong>：Husky 提供了简单易用的 API，可以轻松地在项目中添加和配置 Git hook。与原生的 Git hook 相比，Husky 的配置更加直观和简单，不需要手动编写脚本。</p></li><li><p><strong>跨平台支持</strong>：Husky 可以在 Windows、Linux、macOS 等多个平台上运行，而原生的 Git hook 可能会因为操作系统和 shell 的不同而产生兼容性问题。</p></li><li><p><strong>更强大的功能</strong>：Husky 支持多个 Git hook，可以在不同的 Git 操作时自动触发相应的任务。而原生的 Git hook 只支持有限的几个 hook，需要手动编写脚本来实现更复杂的功能。</p></li><li><p><strong>安全性</strong>：Husky 的配置文件存储在项目的 package.json 文件中，这意味着可以将配置文件提交到代码仓库中进行版本控制，保证配置的安全性和一致性。而原生的 Git hook 需要手动将 hook 脚本添加到 .git&#x2F;hooks 目录中，容易被意外覆盖或删除。</p></li></ul><p><em>因此，接下来需要做的事情是，安装 Husky，配置 <code>commit-msg</code> 拦截<code>git commit</code> 动作，再安装 Commitlint 对拦截到的 commit 信息进行校验。</em></p><h2 id="安装-Husky"><a href="#安装-Husky" class="headerlink" title="安装 Husky"></a>安装 Husky</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm</span></span><br><span class="line">npm install husky --save-dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pnpm</span></span><br><span class="line">pnpm add husky --save-dev</span><br></pre></td></tr></table></figure><p>使用 Husky 安装 Git Hooks</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npx 调用 局部命令 husky</span> </span><br><span class="line">npx husky install</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接路径访问局部命令 husky</span></span><br><span class="line">./node_modules/.bin/husky install</span><br></pre></td></tr></table></figure><details open><summary><strong>💡 npx 是什么？</strong></summary><blockquote><br><p><code>npx</code>是一个Node.js命令行工具，它提供了一种方便的方式来运行本地安装的Node.js包中的可执行文件。npx的作用是在不全局安装包的情况下，运行这些包中的命令。</p><p>通常情况下，在运行命令行工具时，需要全局安装相关的包和依赖项。但是，这种方式可能会导致一些问题，例如不同版本的包之间的冲突，或者需要手动更新全局安装的包等。<code>npx</code>提供了一个解决方案，可以在不全局安装包的情况下，运行这些包中的命令。</p><p>使用<code>npx</code>，可以直接在命令行中指定需要运行的包和命令，<code>npx</code>将会自动查找并运行该包中的命令。例如，可以使用以下命令运行&quot;<code>create-react-app</code>&quot;包中的命令来创建一个新的React应用程序：</p><pre><code>npx create-react-app my-app</code></pre><p>在这个例子中，<code>npx</code>将在本地查找&quot;<code>create-react-app</code>&quot;包，并运行它中的&quot;<code>create-react-app</code>&quot;命令，然后使用&quot;<code>my-app</code>&quot;作为应用程序的名称创建一个新的React应用程序。</p><p>更多 npx 相关信息可参考：<a target="_blank" rel="noopener" href="https://docs.npmjs.com/cli/v9/commands/npx">Npx | Run a command from a local or remote npm package</a></p><br></blockquote></details><br><p>添加 <code>prepare</code> 脚本到 <code>package.json</code> 的 <code>scripts</code> 中，使得在新环境初始化项目时，自动安装 Git Hooks。</p><p>📢 <em>此为可选操作，不做也不影响后续操作，但是推荐执行</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm pkg set scripts.prepare=&quot;husky install&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行以上命令得到的结果是：</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">+    &quot;prepare&quot;: &quot;husky install&quot; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>prepare (since <a href="mailto:npm@4.0.0">&#x6e;&#x70;&#x6d;&#64;&#52;&#x2e;&#x30;&#x2e;&#x30;</a>)</strong></p><p>Runs BEFORE the package is packed<br>Runs BEFORE the package is published<br><mark>Runs on local “npm install” without any arguments</mark><br>Run AFTER <code>prepublish</code>, but BEFORE <code>prepublishOnly</code><br>NOTE: If a package being installed through git contains a <code>prepare</code> script, its <code>dependencies</code> and <code>devDependencies</code> will be installed, and the prepare script will be run, before the package is packaged and installed.</p><p>Refenrence: <a target="_blank" rel="noopener" href="https://docs.npmjs.com/cli/v9/using-npm/scripts">How npm handles the “scripts” field</a></p></blockquote><p>Husky 配置 Hooks 的方式如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/&lt;git hook&gt; &quot;&lt;command that needs to be executed when the hook is triggered&gt;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">e.g.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将在 `git commit` 执行前触发 `npm <span class="built_in">test</span>` 命令</span></span><br><span class="line">npx husky add .husky/pre-commit &quot;npm test&quot;</span><br></pre></td></tr></table></figure><p>至此，Git Hooks 的准备工作已经完成，<code>commit-msg</code> 钩子的配置要在 commitlint 安装完成后配置。</p><h2 id="安装-Commitlint"><a href="#安装-Commitlint" class="headerlink" title="安装 Commitlint"></a>安装 Commitlint</h2><p><code>@commitlint</code> 是一个由多个相关包组成的集合，可以根据需要安装和配置这些包来实现不同的功能。</p><p><code>@commitlint</code> 的核心包是<code>@commitlint/cli</code>，它提供了命令行工具，用于检查提交信息是否符合规范。<code>@commitlint/cli</code>可以通过命令行参数来指定规范，也可以通过配置文件来指定规范。例如，可以使用<code>@commitlint/config-conventional</code>包来定义一个常规的提交信息规范，然后使用<code>@commitlint/cli</code>来检查提交信息是否符合该规范。</p><p>除了<code>@commitlint/cli</code>之外，@commitlint还提供了其他几个相关包，包括：</p><ul><li><code>@commitlint/load</code>: 提供了一个函数，用于加载配置文件并解析它们，以便<code>@commitlint/cli</code>可以使用它们进行检查。</li><li><code>@commitlint/config-conventional</code>: 提供了一组常见的规范，用于检查常规的Git提交信息格式。</li><li><code>@commitlint/config-angular</code>: 提供了一个用于检查Angular项目的提交信息规范。</li><li><code>@commitlint/config-lerna-scopes</code>: 提供了一个用于检查Lerna项目的提交信息规范。</li><li><a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/commitlint/tree/master/%40commitlint">更多相关包…</a></li></ul><p>这些包可以根据具体需要进行安装和配置。</p><hr><p>📢 <em>根据当前的需求，接下来则安装 <code>@commitlint/cli</code> 和 <code>@commitlint/config-conventional</code>(Conventional Commits 规范)</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm</span></span><br><span class="line">npm install --save-dev @commitlint/config-conventional @commitlint/cli</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pnpm</span></span><br><span class="line">pnpm add --save-dev @commitlint/config-conventional @commitlint/cli</span><br></pre></td></tr></table></figure><p>添加 配置文件</p><p><code>@commitlint/cli</code> 支持以下这些默认的配置文件名：</p><ul><li><code>commitlint.config.js</code></li><li><code>.commitlintrc.js</code></li><li><code>.commitlintrc</code></li><li><code>.commitlintrc.json</code></li><li><code>.commitlintrc.yml</code></li></ul><p>为了避免切换模块化语法问题，接下来使用 <code>.commitlintrc.yml</code> 作为配置文件</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .commitlintrc.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 extends 引用 @commitlint/config-conventional 规范</span></span><br><span class="line"><span class="attr">extends:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;@commitlint/config-conventional&#x27;</span></span><br></pre></td></tr></table></figure><p>更多的配置项参考：<a target="_blank" rel="noopener" href="https://commitlint.js.org/#/reference-configuration?id=configuration">Commitlint &gt; Configuration</a></p><p><img src="test_commitlint.gif" alt="Test Commitlint-CLI"></p><h2 id="Husky-Commitlint"><a href="#Husky-Commitlint" class="headerlink" title="Husky + Commitlint"></a>Husky + Commitlint</h2><p>使用 Husky 设置 <code>commit-msg</code> 钩子执行 <code>commitlint-cli</code>, 对 <code>git commit</code> 动作提交的信息进行校验。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/commit-msg  &#x27;npx --no -- commitlint --edit $&#123;1&#125;&#x27;</span><br></pre></td></tr></table></figure><p>在这个命令中，<code>--no</code> 参数是用来禁用 <code>npx</code> 的默认行为的。</p><p>默认情况下，<code>npx</code> 会在运行目标命令之前检查本地是否已经安装了目标命令所在的包，如果没有安装，则会先安装该包，然后再运行目标命令。这种行为通常是有用的，因为它可以确保运行的命令使用的是最新的包版本，并且可以避免不同版本之间的兼容性问题。</p><p>但是，在某些情况下，我们可能不想让 <code>npx</code> 自动安装包，而是希望使用本地已经安装的包。在这种情况下，可以使用 <code>--no</code> 参数来禁用 <code>npx</code> 的默认行为，以便直接使用本地安装的包。</p><p>在这个具体的命令中，<code>--no</code> 参数用来禁用 <code>npx</code> 自动安装 <code>commitlint</code> 包，而是使用本地已经安装的 <code>commitlint</code> 包。</p><p><code>--edit $&#123;1&#125;</code> 是用来编辑指定文件的第一个参数的提交信息，<code>$&#123;1&#125;</code> 代表第一个参数的值，通常是一个文件路径。这个命令的作用是使用本地安装的 <code>commitlint</code> 包来检查指定文件的提交信息是否符合规范，并在编辑器中打开该文件，以便修改提交信息。</p><p><img src="commitlint_by_hook.gif" alt="Commitlint by hook"></p><h2 id="半自动编写-Commit"><a href="#半自动编写-Commit" class="headerlink" title="半自动编写 Commit"></a>半自动编写 Commit</h2><p>以下是使用 Markdown 表格输出 @commitlint&#x2F;prompt-cli 和 Commitizen 的信息：</p><table><thead><tr><th>工具名称</th><th>描述</th><th>npm周下载量（2023&#x2F;07&#x2F;17）</th></tr></thead><tbody><tr><td><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@commitlint/prompt-cli">@commitlint&#x2F;prompt-cli ↗</a></td><td>一个命令行交互式工具，用于帮助开发人员规范化提交信息。它使用 <code>commitlint</code> 配置文件中定义的规则来检查提交信息，确保它们符合预定的格式和风格。该工具还提供了一些提示，帮助开发人员更好地理解如何编写符合规则的提交信息。</td><td><em>67,802</em></td></tr><tr><td><a href="cz-cli">Commitizen ↗</a></td><td>一个命令行交互式工具，用于帮助开发人员规范化提交信息。它使用预定义的提交信息模板来引导开发人员编写符合规则的提交信息，并根据模板中的规则进行验证。与@commitlint&#x2F;prompt-cli不同的是，Commitizen不检查提交信息是否符合commitlint配置文件中定义的规则，而是依靠模板中的规则来确保提交信息的正确性。此外，Commitizen还提供了一些功能，例如自动填充提交信息，以帮助开发人员更快地编写提交信息。</td><td><em>917,033</em></td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm</span></span><br><span class="line">npm add @commitlint/prompt-cli --save-dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pnpm</span></span><br><span class="line">pnpm add @commitlint/prompt-cli --save-dev</span><br></pre></td></tr></table></figure><p><img src="test_prompt-cli.gif" alt="Test prompt-cli"></p><h1 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h1><p>Node.js 遵循的版本号命名规范是 <strong>语义化版本号</strong>（SemVer）规范。很多 Node.js 模块和库的版本号也同样如此。</p><p>SemVer 规范定义了一个三位数字的版本号，格式为 <code>MAJOR.MINOR.PATCH</code>，其中：</p><ul><li><code>MAJOR</code>：主版本号，表示不兼容的 API 变化或重大功能变化。</li><li><code>MINOR</code>：次版本号，表示向后兼容的新功能添加。</li><li><code>PATCH</code>：补丁版本号，表示向后兼容的 bug 修复。</li></ul><p>除了这三位数字之外，SemVer 规范还可以包含一个预发布版本号和一个构建版本号。预发布版本号以连字符 <code>-</code> 开头，构建版本号以加号 <code>+</code> 开头，例如 <code>1.2.3-beta+build.123</code> 表示预发布版本号为 <code>beta</code>，构建版本号为 <code>build.123</code>。</p><p>预发布版本号可以使用以下标识符：</p><ul><li><p><code>alpha</code>：表示内部测试版本或仍在开发中的不稳定版本，可能会包含较多的 bug，不建议用于生产环境。</p></li><li><p><code>beta</code>：表示公开测试版本，已经完成了主要功能的开发，但仍需要进行测试和 bug 修复，建议用于测试环境和开发环境。</p></li><li><p><code>rc</code>：表示候选版本（Release Candidate），已经完成了所有的功能开发和测试，可以用于生产环境，但仍需要进行最后的测试和验证。</p></li></ul><p>需要注意的是，不同的项目可能会有自己的预发布版本号约定，以上标识符仅是语义化版本号规范中常见的预发布版本号标识符。在实际项目中，可以根据项目的特点和需求，自定义预发布版本号标识符。</p><p><img src="Snipaste_2023-07-25_18-24-32.png" alt="SemVer Manage"></p><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><p><em>以下是常用的几个命令：</em></p><ul><li>补丁（patch）预发布版本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm-version</span></span><br><span class="line">npm version prepatch --preid &lt;preid-1&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">~ or ~</span></span><br><span class="line">npm version prepatch --preid=&lt;preid-1&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version --release-as patch --prerelease &lt;preid-1&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">~ or ~</span></span><br><span class="line">npx standard-version -r patch -p &lt;preid-1&gt;</span><br></pre></td></tr></table></figure><ul><li>次（minor）预发布版本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm-version</span></span><br><span class="line">npm version preminor --preid=&lt;preid-1&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -r minor -p &lt;preid-1&gt;</span><br></pre></td></tr></table></figure><ul><li>主（major）预发布版本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm-version</span></span><br><span class="line">npm version premajor --preid=&lt;preid-1&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -r major -p &lt;preid-1&gt;</span><br></pre></td></tr></table></figure><ul><li>基于当前预发布的 <code>preid</code> 自增预发布版号</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm-version</span></span><br><span class="line">npm version prerelease</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -p</span><br></pre></td></tr></table></figure><ul><li>切换至下一个阶段的 <code>preid</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm-version</span></span><br><span class="line">npm version prerelease --preid=&lt;preid-next&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -p &lt;preid-next&gt;</span><br></pre></td></tr></table></figure><ul><li>正式发布</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果最初是以 npm version prepatch 开始</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm-version</span></span><br><span class="line">npm version patch</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">~ or ~</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -r patch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果最初是以 npm version preminor 开始</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm-version</span></span><br><span class="line">npm version minor</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">~ or ~</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -r minor</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果最初是以 npm version premajor 开始</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm-version</span></span><br><span class="line">npm version major</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">~ or ~</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -r major</span><br></pre></td></tr></table></figure><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p><em>下面以发布补丁的预发布版本为例，假定初始版本是 <code>0.0.1</code></em></p><p><strong>Step-1</strong>：更新补丁的 <code>alpha</code> 预发布版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">npm version prepatch --preid=alpha</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output: 0.0.2-alpha.0</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version --release-as patch --prerelease alpha</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">~ or ~</span></span><br><span class="line">npx standard-version -r patch -p alpha</span><br></pre></td></tr></table></figure><p><strong>Step-2</strong>：更新补丁的 <code>alpha</code> 预发布版本版号自增</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm version prerelease</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output: 0.0.2-alpha.1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -p</span><br></pre></td></tr></table></figure><p><strong>Step-3</strong>：更新补丁的下一个阶段的预发布版本，<code>beta</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换预发布版本至 beta</span></span><br><span class="line">npm version prerelease --preid=beta</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output: 0.0.2-beta.0</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -p beta</span><br></pre></td></tr></table></figure><p><strong>Step-4</strong>：更新补丁的 <code>beta</code> 预发布版本版号自增</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在beta上，自增预发布版号</span></span><br><span class="line">npm version prerelease</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output: 0.0.2-beta.1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -p</span><br></pre></td></tr></table></figure><p><strong>Step-5</strong>：更新补丁的下一个阶段的预发布版本，<code>rc</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">切换预发布版本至 rc</span></span><br><span class="line">npm version prerelease --preid=rc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output: 0.0.2-rc.0</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -p rc</span><br></pre></td></tr></table></figure><p><strong>Step-6</strong>：更新补丁的 <code>rc</code> 预发布版本版号自增</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在rc上，自增预发布版号</span></span><br><span class="line">npm version prerelease</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output: 0.0.2-rc.1</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -p</span><br></pre></td></tr></table></figure><p><strong>Step-7</strong>: 发布正式版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm version patch</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">output: 0.0.2</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">npx standard-version -r patch</span><br></pre></td></tr></table></figure><p><img src="Snipaste_2023-07-25_18-23-41.png" alt="Example for version manage"></p><h2 id="Npm-Version生命周期"><a href="#Npm-Version生命周期" class="headerlink" title="Npm-Version生命周期"></a>Npm-Version生命周期</h2><p>在介绍 <code>conventional-changelog-cli</code> 使用的章节中，它配合了 <code>package.json</code> 的 <code>scripts</code> 脚本使用。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># package.json</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;conventional-changelog -p angular -i CHANGELOG.md -s &amp;&amp; git add CHANGELOG.md&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>通过 <code>npm version &lt;patch | minor | major ...&gt;</code> 命令生成 CHANGELOG。</p><p>❓ <em>为什么是 <code>version</code> 脚本？</em></p><p>❓ <em>为什么是 <code>npm version</code> 而不是 <code>npm run version</code>？</em></p><p>下面将带着这两个疑问拆解 <code>npm-version</code> 的生命周期。</p><hr><p><code>npm version &lt;cmd&gt;</code> 在执行后，按顺序先后执行以下流程：</p><ol><li><p>执行 <code>preversion</code> 脚本（如果有定义）；</p></li><li><p>更新 <code>package.json</code> 文件中的版本号；</p></li><li><p>执行 <code>version</code> 脚本（如果有定义）；</p></li><li><p>提交版本更新；</p></li><li><p>创建 Git 标签；</p></li><li><p>执行 <code>postversion</code> 脚本（如果有定义）；</p></li></ol><p><img src="Snipaste_2023-07-26_11-28-57.png" alt="LifeCycle of npm-version"></p><p><em>例如，执行 <code>npm version patch</code> 命令会触发以下操作：</em></p><p><strong>1. 执行 <code>preversion</code> 脚本（如果有定义）</strong>：在执行版本更新操作之前执行 <code>preversion</code> 脚本。例如，如果在 <code>package.json</code> 文件中定义了以下 <code>preversion</code> 脚本：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;preversion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run lint&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>则在执行 <code>npm version patch</code> 命令时，会先执行 <code>npm run lint</code> 命令，检查代码是否符合规范。</p><p><strong>2. 更新 <code>package.json</code> 文件中的版本号</strong>：<code>npm version patch</code> 命令会将 <code>package.json</code> 文件中的版本号自动加1，并将新版本号写回 <code>package.json</code> 文件中。</p><p><strong>3. 执行 <code>version</code> 脚本（如果有定义）</strong>：在更新版本号之后执行 <code>version</code> 脚本。例如，如果在 <code>package.json</code> 文件中定义了以下 <code>version</code> 脚本：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run build&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>则在执行 <code>npm version patch</code> 命令时，会执行 <code>npm run build</code> 命令，自动生成构建文件。</p><p><strong>4. 提交版本更新</strong>：<code>npm version patch</code> 命令会自动执行 <code>git add</code> 和 <code>git commit</code> 命令，将更新后的 <code>package.json</code> 文件提交到 Git 仓库中。提交信息默认为 <code>&quot;v&lt;new-version&gt;&quot;</code>，例如，如果新版本号为 1.0.1，则提交信息为 “v1.0.1”。</p><p><strong>5. 创建 Git 标签</strong>：<code>npm version patch</code> 命令会自动执行 <code>git tag</code> 命令，为当前提交创建一个新的 Git 标签。标签名默认为 <code>&quot;v&lt;new-version&gt;&quot;</code>，例如，如果新版本号为 1.0.1，则标签名为 “v1.0.1”。</p><p><strong>6. 执行 <code>postversion</code> 脚本（如果有定义）</strong>：在提交版本更新之后执行 <code>postversion</code> 脚本。例如，如果在 <code>package.json</code> 文件中定义了以下 <code>postversion</code> 脚本：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;postversion&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm publish&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>则在执行 <code>npm version patch</code> 命令并成功提交版本更新后，会执行 <code>npm publish</code> 命令，将新版本发布到 npm 仓库中。</p><hr><p>上面提到了 <code>standard-version</code> 和 <code>conventional-changelog-cli</code>，它们都被用于生成 CHANGELOG。</p><p>在使用 <code>conventional-changelog-cli</code> 时，生成 CHANGELOG 的命令被设置到了 <code>package.json</code> 中的 <code>scripts.version</code>:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># package.json</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;conventional-changelog -p angular -i CHANGELOG.md -s &amp;&amp; git add CHANGELOG.md&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>❓ <em>为什么是 <code>npm version</code> 而不是 <code>npm run version</code>？</em></p><p>从上面可以知道，<code>version</code> 脚本的触发，是 <code>npm-version</code> 生命周期的一部分。所以可以通过 <code>npm-version</code> 命令更新版本的同时触发 <code>version</code> 脚本生成 CHANGELOG。</p><p>❓ <em>为什么是 <code>version</code> 脚本？</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conventional-changelog -p angular -i CHANGELOG.md -s \</span><br><span class="line">  &amp;&amp; git add CHANGELOG.md</span><br></pre></td></tr></table></figure><p>这段命令包含了两部分：</p><ul><li><p>生成 CHANGELOG, <code>conventional-changelog -p angular -i CHANGELOG.md -s</code>;</p></li><li><p>将新版本对应的 CHANGELOG 变动添加到 Git 仓库的暂存区，<code>git add CHANGELOG.md</code>。</p></li></ul><p><code>version</code> 脚本的触发介乎于 “更新 package.json 文件中的版本号” 与 “提交版本更新” 之间。</p><p>生成 CHANGELOG 需要知道 新的版号。<code>version</code> 脚本的触发在 “提交版本更新” 之前，所以只要在 <code>version</code> 触发时将变动添加到Git仓库暂存区，“提交版本更新” 的 commit 就可以包含 CHANGELOG 的变动。</p><h2 id="Standard-Version的生命周期"><a href="#Standard-Version的生命周期" class="headerlink" title="Standard-Version的生命周期"></a>Standard-Version的生命周期</h2><p>在上一节 <a href>Npm-version生命周期</a> 中提到了 <code>conventional-changelog-cli</code>，但是没有提到 <code>standard-version</code>。因为 <code>standard-version</code> 有它自己的生命周期，而且在使用 <code>standard-version</code> 做版本号更新和 CHANGELOG 生成时，<strong>并不会触发 <code>npm-version</code> 的脚本（<code>preversion</code>、<code>version</code> 和 <code>postversion</code>）</strong>！</p><p><strong><code>standard-version</code> 的生命周期:</strong></p><ol><li><p>更新项目版本号；</p></li><li><p>生成 CHANGELOG；</p></li><li><p>提交版本 commit（包含 package.json的version 和 changelog的变动）；</p></li><li><p>创建版本的 <code>git-tag</code>；</p></li></ol><p><img src="Snipaste_2023-07-26_21-57-36.png" alt="lifecycle of standard-version"></p><p>📢 <strong>注意</strong>：<em>上图中的这句命令并没有执行，仅仅是提示！</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Run `git push --follow-tags origin master &amp;&amp; npm publish --tag prerelease` to publish</span><br></pre></td></tr></table></figure><p><strong><code>standard-version</code> 的生命周期中触发的脚本</strong></p><ul><li><p><code>prerelease</code>: 在任何事情发生之前执行。 如果 <code>prerelease</code> 脚本返回非零退出代码（<code>process.exit()</code>），版本控制将中止，但对进程没有其他影响。</p></li><li><p><code>prebump/postbump</code>: 在版本更新之前和之后执行。 如果 <code>prebump</code> 脚本返回一个版本号，将使用它而不是 <code>standard-version</code> 计算的版本。</p></li><li><p><code>prechangelog/postchangelog</code>: 在生成 CHANGELOG 之前和之后执行。</p></li><li><p><code>precommit/postcommit</code>: 在提交版本 commit 之前和之后调用。</p></li><li><p><code>pretag/posttag</code>: 在添加 <code>git-tag</code> 步骤之前和之后调用。</p></li></ul><blockquote><p><strong>Lifecycle Scripts</strong><br>standard-version supports lifecycle scripts. These allow you to execute your own supplementary commands during the release. The following hooks are available and execute in the order documented:</p><ul><li><p><code>prerelease</code>: executed before anything happens. If the <code>prerelease</code> script returns a non-zero exit code, versioning will be aborted, but it has no other effect on the process.</p></li><li><p><code>prebump/postbump</code>: executed before and after the version is bumped. If the <code>prebump</code> script returns a version #, it will be used rather than the version calculated by <code>standard-version</code>.</p></li><li><p><code>prechangelog/postchangelog</code>: executes before and after the CHANGELOG is generated.</p></li><li><p><code>precommit/postcommit</code>: called before and after the commit step.</p></li><li><p><code>pretag/posttag</code>: called before and after the tagging step.</p></li></ul></blockquote><p><img src="Snipaste_2023-07-27_04-51-22.png"></p><p><strong>📢 注意</strong>：*<code>standard-version</code> 触发的脚本是 <code>strandard-version.scripts.*</code>，而不是 <code>scripts.*</code>。*</p><p><img src="Snipaste_2023-07-26_20-14-55.png"></p><h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><p><code>standard-version</code> 并非基于 <code>npm-version</code> 实现，它与 <code>npm-version</code> 相互独立。<code>standard-version</code> 有自己的生命周期，与 <code>npm-version</code> 不重合，在 <code>standard-version</code> 工作过程中不会触发 <code>npm-version</code> 生命周期脚本（<code>preversion</code>、<code>version</code> 和 <code>postversion</code>）。</p><p><code>standard-version</code> 的生命周期中，<em>包含 4 个工作点</em>：</p><ul><li><p>更新项目版本号；</p></li><li><p>生成 CHANGELOG；</p></li><li><p>提交版本 commit（包含 package.json的version 和 changelog的变动）；</p></li><li><p>创建版本的 <code>git-tag</code>；</p></li></ul><p><em>包含 9 个钩子脚本</em>：</p><ul><li><p><code>prerelease</code></p></li><li><p><code>prebump/postbump</code></p></li><li><p><code>prechangelog/postchangelog</code></p></li><li><p><code>precommit/postcommit</code></p></li><li><p><code>pretag/posttag</code></p></li></ul><p><code>standard-version</code> 与 <code>npm-version</code> 在 <code>package.json</code> 中定义脚本的格式不一样：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm-version</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;preversion&quot;: &quot;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">standard-version</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;standard-version&quot;: &#123;</span><br><span class="line">    &quot;scripts&quot;: &#123;</span><br><span class="line">      &quot;prerelease&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="CHANGELOG自动化"><a href="#CHANGELOG自动化" class="headerlink" title="CHANGELOG自动化"></a>CHANGELOG自动化</h1><h2 id="conventional-changelog-cli"><a href="#conventional-changelog-cli" class="headerlink" title="conventional-changelog-cli"></a>conventional-changelog-cli</h2><p><code>conventional-changelog-cli</code> 是一个命令行工具，用于生成符合规范的 changelog。它可以根据项目的 commit message 格式，自动解析 commit 信息，并将其转换为人类可读的 changelog。</p><p>这个工具的基本原理是将符合规范的 commit message 按照类型（type）和 scope 等信息进行分类，然后根据分类的结果生成 changelog。</p><p><code>conventional-changelog-cli</code> 支持使用多种预设（preset）来生成 changelog，包括 <code>angular</code>、<code>atom</code>、<code>codemirror</code>、<code>conventionalcommits</code>、<code>ember</code>、<code>eslint</code>、<code>express</code>、<code>jquery</code> 和 <code>jshint</code> 等。你也可以使用自定义的配置文件来生成 changelog。</p><p>以下是 <code>conventional-changelog-cli</code> 的一些常用命令：</p><ul><li><p><code>conventional-changelog</code>: 生成 changelog，默认使用 Angular 规范。</p></li><li><p><code>conventional-changelog -p [preset]</code>: 生成指定预设的 changelog。</p></li><li><p><code>conventional-changelog -i [file]</code>: 将 changelog 写入到指定文件中。</p></li><li><p><code>conventional-changelog -s</code>: 将 changelog 添加到文件的开头而不是结尾。</p></li><li><p><code>conventional-changelog --release-count [number]</code>: 指定要包括的版本数量。</p></li><li><p><code>conventional-changelog --config [file]</code>: 使用自定义的配置文件生成 changelog。</p></li></ul><p>通过 <code>conventional-changelog-cli</code>，你可以方便地生成符合规范的 changelog，并且可以根据自己的需要进行自定义配置和预设，以满足项目的需求。</p><p>📢 <em>在默认情况下，<code>conventional-changelog-cli</code> 会匹配 <code>feat</code>、<code>fix</code> 类型的commits，并根据它们生成CHANGELOG</em></p><blockquote><br><pre><code class="language-shell">npm install -g conventional-changelog-cli
  cd my-project
  conventional-changelog -p angular -i CHANGELOG.md -s
  </code></pre><p>This will not overwrite any previous changelogs. <mark>The above generates a changelog based on commits since the last semver tag that matches the pattern of &quot;Feature&quot;, &quot;Fix&quot;, &quot;Performance Improvement&quot; or &quot;Breaking Changes&quot;.</mark></p><br></blockquote><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm</span></span><br><span class="line">npm install conventional-changelog-cli --save-dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pnpm</span></span><br><span class="line">pnpm add conventional-changelog-cli --save-dev</span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx conventional-changelog -p conventionalcommits -i CHANGELOG.md -s</span><br></pre></td></tr></table></figure><ul><li><p><code>-p conventionalcommit</code>：指定使用 conventionalcommit 规范生成 CHANGELOG 文件。<code>conventionalcommit</code> 是一种常见的规范，适用于大多数项目。</p></li><li><p><code>-i CHANGELOG.md</code>：指定将生成的 CHANGELOG 文件输出到名为 <code>CHANGELOG.md</code> 的文件中。如果该文件不存在，则会创建它；如果已存在，则会覆盖它。</p></li><li><p><code>-s</code>：指定生成的 CHANGELOG 文件中是否应包含当前版本之前的所有版本的变更记录。默认情况下，只会生成当前版本的变更记录。</p></li></ul><p><strong>结合 <code>npm version</code> 使用</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;version&quot;: &quot;conventional-changelog -p angular -i CHANGELOG.md -s &amp;&amp; git add CHANGELOG.md&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cli</span></span><br><span class="line">npm version &lt;version&gt;</span><br></pre></td></tr></table></figure><p>具体来说，当您执行 <code>npm version</code> 命令时，会按照以下顺序执行：</p><ul><li><p>执行 <code>scripts.version</code> 脚本，如果已经定义的话。<code>scripts.version</code> 脚本会返回一个字符串，表示新的版本号，如果没有定义 <code>scripts.version</code> 脚本，则使用默认的 SemVer 规范生成版本号。</p></li><li><p>将新的版本号更新到 package.json 文件中。</p></li><li><p>自动化执行 Git 操作，包括添加修改的 package.json 和生成的 changelog 文件、提交代码并打 Git tag。</p></li></ul><p>因此执行 <code>npm version &lt;version&gt;</code>的结果是：1）更新 <code>package.json</code> 的 <code>version</code> 字段；2）更新 CHANGELOG；3）生成包含 1、2 的 commit 和 git-tag。</p><p><strong>修改 version-commit</strong></p><p>默认的 <code>version-commit</code> 是下面这样的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">commit 1d37dcf6dc685d0a49319d0c2e0a0a272af8fa7a (tag: v3.3.8)</span><br><span class="line">Author: isaaxite &lt;isaacgun@outlook.com&gt;</span><br><span class="line">Date:   Tue Jul 25 05:00:36 2023 +0800</span><br><span class="line"></span><br><span class="line">    3.3.8</span><br></pre></td></tr></table></figure><p>显然这样是不符合规范的。下面有 2 个方法可是使之合乎规范。</p><p><em>手动设置</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">%s 是版本号的占位符</span></span><br><span class="line"></span><br><span class="line">npm version patch -m &quot;chore: bump version to %s&quot;</span><br></pre></td></tr></table></figure><p><em>配置文件设置</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.npmrc</span></span><br><span class="line"></span><br><span class="line">commit-hooks=true</span><br><span class="line">tag-version-prefix=v</span><br><span class="line">message=&quot;chore: bump version to %s&quot;</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>从 <code>conventional-changelog-cli</code> 的 README 中没有太多关于配置的信息，仅仅是引导去查阅 <code>conventional-changelog</code> 和 <code>conventional-changelog-core</code>。</p><p>从其他的一些参考资料确实有介绍 <code>conventional-changelog-cli</code> 是基于 <code>conventional-changelog-core</code> 开发的。</p><blockquote><p>To fully customize the tool, please checkout <mark>conventional-changelog</mark> and <mark>conventional-changelog-core</mark> docs. You can find more details there. Note: config here can work with preset, which is different than options.config in conventional-changelog.</p></blockquote><p>但是，实际上 <code>conventional-changelog</code> 并没有太多关于配置的信息，仅仅是一个类似一个一级引导页的README!</p><p>而 <code>conventional-changelog-core</code> 相对有用一点，会介绍 API 的参数，但是并没有明确那些参数是可以复用到配置文件上的。</p><p>使用 <code>conventional-changelog --help</code> 有看到关于配置相关的描述：</p><blockquote><p><code>-n, --config</code> A filepath of your config script Example of a config script: <a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/conventional-changelog/blob/master/packages/conventional-changelog-cli/test/fixtures/config.js">https://github.com/conventional-changelog/conventional-changelog/blob/master/packages/conventional-changelog-cli/test/fixtures/config.js</a></p></blockquote><p>打开的是一个过于简单的页面，并没有注释介绍参数作用，有用的参考信息约等于没有！</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">writerOpts</span>: &#123;</span><br><span class="line">    <span class="attr">mainTemplate</span>: <span class="string">&#x27;&#123;&#123;commitGroups.[0].commits.[0].type&#125;&#125;&#123;&#123;testContext&#125;&#125;template&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>综合以上，基本可以认识到一个事实：</em></p><p><strong><code>conventional-changelog-cli</code> 具备配置的能力，但是缺少配置指引，以致配置体验不友好。基本可以认为这个工具的配置能力约等于“无”</strong></p><hr><p><em>本着研究的态度阅读 <code>conventional-changelog-cli</code> 的源码，探索它的配置详情！</em></p><p>通过阅读 <code>conventional-changelog-cli/cli.js</code> 代码，发现以下5个配置项可以从从配置文件中读取：</p><ul><li><p><code>options</code></p></li><li><p><code>templateContext</code></p></li><li><p><code>gitRawCommitsOpts</code></p></li><li><p><code>parserOpts</code></p></li><li><p><code>writerOpts</code></p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (flags.<span class="property">context</span>) &#123;</span><br><span class="line">|   templateContext = <span class="built_in">require</span>(<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), flags.<span class="property">context</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (flags.<span class="property">config</span>) &#123;</span><br><span class="line">|   config = <span class="built_in">require</span>(<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), flags.<span class="property">config</span>))</span><br><span class="line">    options.<span class="property">config</span> = config</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (config.<span class="property">options</span>) &#123;</span><br><span class="line">|     options = &#123;</span><br><span class="line">        ...options,</span><br><span class="line">        ...config.<span class="property">options</span>,</span><br><span class="line">        <span class="attr">pkg</span>: &#123;</span><br><span class="line">          ...options.<span class="property">pkg</span>,</span><br><span class="line">          ...config.<span class="property">options</span>.<span class="property">pkg</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    config = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Failed to get file. &#x27;</span> + err)</span><br><span class="line">  process.<span class="title function_">exit</span>(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gitRawCommitsOpts = &#123;</span><br><span class="line">| ...config.<span class="property">gitRawCommitsOpts</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changelogStream = <span class="title function_">conventionalChangelog</span>(</span><br><span class="line">  options, </span><br><span class="line">  templateContext, </span><br><span class="line">  gitRawCommitsOpts, </span><br><span class="line">| config.<span class="property">parserOpts</span>, </span><br><span class="line">| config.<span class="property">writerOpts</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>在源码中可以知道, 以上 5 个配置项分别读取自不同的2个文件，它们分别是 <code>context</code> 配置文件 和 <code>config</code> 配置文件。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// context</span></span><br><span class="line">templateContext = <span class="built_in">require</span>(<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), flags.<span class="property">context</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// config</span></span><br><span class="line">config = <span class="built_in">require</span>(<span class="title function_">resolve</span>(process.<span class="title function_">cwd</span>(), flags.<span class="property">config</span>))</span><br></pre></td></tr></table></figure><p><code>context</code> 配置文件：</p><ul><li><code>templateContext</code></li></ul><p><code>config</code> 配置文件：</p><ul><li><p><code>options</code></p></li><li><p><code>gitRawCommitsOpts</code></p></li><li><p><code>parserOpts</code></p></li><li><p><code>writerOpts</code></p></li></ul><p><code>npx conventional-changelog --help</code> 中关于 <code>context</code> 配置文件 和 <code>config</code> 配置文件的描述</p><blockquote><p><code>-c, --context</code> A filepath of a json that is used to define template variables</p><p><code>-n, --config</code> A filepath of your config script. Example of a config script: <a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/conventional-changelog/blob/master/packages/conventional-changelog-cli/test/fixtures/config.js">https://github.com/conventional-changelog/conventional-changelog/blob/master/packages/conventional-changelog-cli/test/fixtures/config.js</a></p></blockquote><p>结合 <code>--help</code>的描述和配置文件的引入方式（<code>require</code>），可以推断 <code>context</code> 配置文件 和 <code>config</code> 配置文件的内容和语法。</p><p><em><code>context</code> 配置文件</em></p><p>支持的配置项及其详情参考：<a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-writer#context">conventional-changelog-writer &gt; context</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">conventional-changelog.context.js</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">支持的配置项参考：</span></span><br><span class="line"><span class="comment">https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-writer#context</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用<code>context</code> 配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx conventional-changelog --context conventional-changelog.context.js</span><br></pre></td></tr></table></figure><p><em><code>config</code> 配置文件</em></p><p>支持的4个配置项及其详情参考：</p><ul><li><p><code>gitRawCommitsOpts</code>: <a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/git-raw-commits#gitopts">conventional-changelog&#x2F;packages&#x2F;git-raw-commits &gt; gitopts</a></p></li><li><p><code>parserOpts</code>: <a target="_blank" rel="noopener" href="https://github.com/conventional-changelog-archived-repos/conventional-commits-parser#options">conventional-commits-parser &gt; options</a></p></li><li><p><code>writerOpts</code>: <a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-writer#options">conventional-changelog-writer &gt; options</a></p></li><li><p><code>options</code>: <a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-core#options">conventional-changelog-core &gt; options</a></p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// conventional-changelog.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 参考：https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/git-raw-commits#gitopts</span></span><br><span class="line">  <span class="attr">gitRawCommitsOpts</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 参考：https://github.com/conventional-changelog-archived-repos/conventional-commits-parser#conventionalcommitsparseroptions</span></span><br><span class="line">  <span class="attr">parserOpts</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 参考：https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-writer#options</span></span><br><span class="line">  <span class="attr">writerOpts</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 参考：https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-core#options</span></span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用<code>config</code> 配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx conventional-changelog --config conventional-changelog.config.js</span><br></pre></td></tr></table></figure><h3 id="preset"><a href="#preset" class="headerlink" title="preset"></a>preset</h3><p>Standard Version 是一个命令行工具，可用于自动生成符合语义化版本规范的版本标签和 CHANGELOG。它使用 Git 元数据（如提交消息）来确定下一个版本号，然后生成标签和更新日志。</p><p><code>standard-version</code> 和 <code>conventional-changelog-cli</code> 都是基于 <code>conventional-changelog</code> 实现的工具。</p><p>但是有别于 <code>conventional-changelog-cli</code>, <code>standard-version</code> 是明确支持配置文件，并且有较为详细的指引介绍如何配置(<a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/standard-version#configuration">Standard Version &gt; configuration</a>)。</p><blockquote><p><strong>Configuration</strong></p><p>You can configure <code>standard-version</code> either by:</p><p>Placing a <code>standard-version</code> stanza in your package.json (assuming your project is JavaScript).<br><mark>Creating a ‘.versionrc’, ‘.versionrc.json’ or ‘.versionrc.js’.</mark><br>If you are using a <code>.versionrc.js</code> your default export must be a configuration object, or a function returning a configuration object.<br>Any of the command line parameters accepted by <code>standard-version</code> can instead be provided via configuration. <mark>Please refer to the <a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/conventional-changelog-config-spec/">conventional-changelog-config-spec</a> for details on available configuration options.</mark></p></blockquote><p><code>standard-version</code> 配置文件的包含全部设置项的例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .versionrc.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">header</span>: <span class="string">&#x27;# Changelog&#x27;</span>,</span><br><span class="line">  <span class="attr">types</span>: [</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;feat&#x27;</span>, <span class="attr">section</span>: <span class="string">&#x27;Features&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;fix&#x27;</span>, <span class="attr">section</span>: <span class="string">&#x27;Bug Fixes&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;chore&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;docs&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;style&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;refactor&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;perf&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;test&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">preMajor</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">commitUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;owner&#125;&#125;/&#123;&#123;repository&#125;&#125;/commit/&#123;&#123;hash&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">compareUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;owner&#125;&#125;/&#123;&#123;repository&#125;&#125;/compare/&#123;&#123;previousTag&#125;&#125;...&#123;&#123;currentTag&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">issueUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;owner&#125;&#125;/&#123;&#123;repository&#125;&#125;/issues/&#123;&#123;id&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">userUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;user&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">releaseCommitMessageFormat</span>: <span class="string">&#x27;chore(release): &#123;&#123;currentTag&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">issuePrefixes</span>: [ <span class="string">&#x27;#&#x27;</span> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>两者都基于相同上游库开发，但是只有 <code>standard-version</code> 支持配置，而且是有别于上面 <code>conventional-changelog-cli</code> 介绍过的配置方式。这是为什么？</em></p><p><em>抱着这个疑问阅读 <code>standard-version</code> 相关的代码！</em></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// standard-version/lib/lifecycles/changelog.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changelogStream = <span class="title function_">conventionalChangelog</span>(&#123;</span><br><span class="line">  <span class="attr">debug</span>: args.<span class="property">verbose</span> &amp;&amp; <span class="variable language_">console</span>.<span class="property">info</span>.<span class="title function_">bind</span>(<span class="variable language_">console</span>, <span class="string">&#x27;conventional-changelog&#x27;</span>),</span><br><span class="line">  <span class="attr">preset</span>: <span class="title function_">presetLoader</span>(args),</span><br><span class="line">  <span class="attr">tagPrefix</span>: args.<span class="property">tagPrefix</span></span><br><span class="line">&#125;, context, &#123; <span class="attr">merges</span>: <span class="literal">null</span>, <span class="attr">path</span>: args.<span class="property">path</span> &#125;)</span><br></pre></td></tr></table></figure><p><strong>🔬 通过“打印”的方式确认了是 <code>presetLoader(args)</code> 引入了 <code>.versionrc.js</code> 的配置内容</strong></p><p><em>与上面例子有所区别是，在例子的基础上有增了 <code>name</code> 属性：</em></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;/home/isaac/workspace/temp/node_modules/.pnpm/conventional-changelog-conventionalcommits@4.6.3/node_modules/conventional-changelog-conventionalcommits/index.js&#x27;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从 <code>npx conventional-changelog --help</code> 的描述上看，<code>--preset</code> 是指定 commit 规范。而 <code>--preset</code> 的设置值仅仅一个较短字符串，而不是上面探索到的对象形式的值。</p><blockquote><p><code>-p, --preset</code> Name of the preset you want to use. Must be one of the following: angular, atom, codemirror, conventionalcommits, ember, eslint, express, jquery or jshint</p></blockquote><p>从上面 <code>standard-version</code> 的源码可知道， <code>preset</code> 是对应到前文 <code>conventional-changelog.config.js</code> 中的 <code>options.preset</code>，基于以上信息，进行下面的尝试。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// conventional-changelog.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">preset</span>: &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;/home/isaac/workspace/temp/node_modules/.pnpm/conventional-changelog-conventionalcommits@4.6.3/node_modules/conventional-changelog-conventionalcommits/index.js&#x27;</span>,</span><br><span class="line">      <span class="attr">header</span>: <span class="string">&#x27;# Changelog&#x27;</span>,</span><br><span class="line">      <span class="attr">types</span>: [</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;feat&#x27;</span>, <span class="attr">section</span>: <span class="string">&#x27;Features&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;fix&#x27;</span>, <span class="attr">section</span>: <span class="string">&#x27;Bug Fixes&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;chore&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;docs&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;style&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;refactor&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;perf&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">&#x27;test&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">preMajor</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">commitUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;owner&#125;&#125;/&#123;&#123;repository&#125;&#125;/commit/&#123;&#123;hash&#125;&#125;&#x27;</span>,</span><br><span class="line">      <span class="attr">compareUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;owner&#125;&#125;/&#123;&#123;repository&#125;&#125;/compare/&#123;&#123;previousTag&#125;&#125;...&#123;&#123;currentTag&#125;&#125;&#x27;</span>,</span><br><span class="line">      <span class="attr">issueUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;owner&#125;&#125;/&#123;&#123;repository&#125;&#125;/issues/&#123;&#123;id&#125;&#125;&#x27;</span>,</span><br><span class="line">      <span class="attr">userUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;user&#125;&#125;&#x27;</span>,</span><br><span class="line">      <span class="attr">releaseCommitMessageFormat</span>: <span class="string">&#x27;chore(release): &#123;&#123;currentTag&#125;&#125;&#x27;</span>,</span><br><span class="line">      <span class="attr">issuePrefixes</span>: [ <span class="string">&#x27;#&#x27;</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>详细设置项参考：<a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/conventional-changelog-config-spec/">conventional-changelog-config-spec</a></p><p><strong>结论是可以的！</strong></p><p>但是，并不是全部属性都有效果！下面是几个尝试后得到的结论：</p><ul><li><p><code>name</code>，必选设置，preset 的设置项生效的前提是们需要设置 <code>name</code> 属性。这是测试出来的结果，没有继续深挖！<code>name</code> 属性在两种设置方式下有效：1）如上面文件的；2）<code>name: &#39;conventional-changelog-conventionalcommits&#39;</code>;</p></li><li><p><code>header</code>，无效。查阅了 <code>standard-version</code> 的源码。关于 header 的实现，是独立与 <code>conventional-changelog</code> 的，所以不生效也正常。</p></li><li><p><code>types</code>，正常有效的。</p></li><li><p>其他，正常有效。</p><ul><li><code>preMajor</code></li><li><code>commitUrlFormat</code></li><li><code>compareUrlFormat</code></li><li><code>issueUrlFormat</code></li><li><code>userUrlFormat</code></li><li><code>releaseCommitMessageFormat</code></li><li><code>issuePrefixes</code></li></ul></li></ul><h4 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h4><p>通过 preset 配置 <code>conventional-changelog-cli</code> 是从源码中得到的非正道的知识，在 conventional-changelog 的工具集中并没有相关的资料说明可以使用preset通过对象形式值去配置。所以这是一个不推荐在生产项目下使用的功能，是个不被保证的功能。</p><h2 id="Standard-Version"><a href="#Standard-Version" class="headerlink" title="Standard Version"></a>Standard Version</h2><p>Standard Version 和 conventional-changelog-cli 都是用于自动生成版本更新和 CHANGELOG 的命令行工具。它们都是基于 <code>conventional-changelog</code> 事先。</p><p>Standard Version 除了能够生成 CHANGELOG 之外，还能够自动创建 Git 标签、增加版本号，以及自动推送标签到 Git 仓库等。conventional-changelog-cli 则只是生成 CHANGELOG 文件。</p><p>Standard Version 的社区支持度相对来说更高，有较多的用户和贡献者，开发维护更新也更加频繁。而 conventional-changelog-cli 的社区支持度相对较低，开发维护更新也不如 Standard Version 频繁。</p><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm</span></span><br><span class="line">npm install standard-version --save-dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">pnpm</span></span><br><span class="line">pnpm add standard-version --save-dev</span><br></pre></td></tr></table></figure><h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;release&quot;</span>: <span class="string">&quot;standard-version&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Standard Version 是推荐使用它来代替 <code>npm version</code> 进行版本管理的。</p><p>Standard Version 将版本管理与 CHANGELOG 结合在一起，在使用 <code>standard-version</code> 更新版本号时，会自动触发 CHANGELOG 的更新。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">release</span></span><br><span class="line">npx standard-version -r 0.0.1</span><br><span class="line"></span><br><span class="line">npx standard-version -r 0.0.1-0</span><br><span class="line">npx standard-version -r 0.0.1-1</span><br><span class="line"></span><br><span class="line">npx standard-version -r 0.0.1-beta.0</span><br><span class="line">npx standard-version -r 0.0.1-beta.1</span><br></pre></td></tr></table></figure><h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><p>默认的配置文件名是：<code>.versionrc</code>, <code>.versionrc.json</code> or <code>.versionrc.js</code></p><p>详细设置项参考：<a target="_blank" rel="noopener" href="https://github.com/conventional-changelog/conventional-changelog-config-spec/">conventional-changelog-config-spec</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .versionrc.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">header</span>: <span class="string">&#x27;# Changelog&#x27;</span>,</span><br><span class="line">  <span class="attr">types</span>: [</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;feat&#x27;</span>, <span class="attr">section</span>: <span class="string">&#x27;Features&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;fix&#x27;</span>, <span class="attr">section</span>: <span class="string">&#x27;Bug Fixes&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;chore&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;docs&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;style&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;refactor&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;perf&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">type</span>: <span class="string">&#x27;test&#x27;</span>, <span class="attr">hidden</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">preMajor</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">commitUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;owner&#125;&#125;/&#123;&#123;repository&#125;&#125;/commit/&#123;&#123;hash&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">compareUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;owner&#125;&#125;/&#123;&#123;repository&#125;&#125;/compare/&#123;&#123;previousTag&#125;&#125;...&#123;&#123;currentTag&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">issueUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;owner&#125;&#125;/&#123;&#123;repository&#125;&#125;/issues/&#123;&#123;id&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">userUrlFormat</span>: <span class="string">&#x27;&#123;&#123;host&#125;&#125;/&#123;&#123;user&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">releaseCommitMessageFormat</span>: <span class="string">&#x27;chore(release): &#123;&#123;currentTag&#125;&#125;&#x27;</span>,</span><br><span class="line">  <span class="attr">issuePrefixes</span>: [ <span class="string">&#x27;#&#x27;</span> ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="工作流-1"><a href="#工作流-1" class="headerlink" title="工作流"></a>工作流</h1><p><img src="Snipaste_2023-07-26_11-57-45.png" alt="work flow"></p><p><strong>1. 创建开发分支</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin main</span><br><span class="line"></span><br><span class="line">git checkout -b feat/xxx origin/main</span><br></pre></td></tr></table></figure><p><strong>2. Commit 变动</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">全手动commit，让commitlint检测</span></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line">git commit -m &quot;feat(scope): add a new feat&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">半自动辅助编辑commit</span></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line">npx commit</span><br></pre></td></tr></table></figure><p><strong>3. Push开发分支</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin feat/xxx</span><br></pre></td></tr></table></figure><p><strong>4. 合并开发分支</strong></p><p><strong>5. 版本管理</strong></p><p>切换到主分支，并更新到最新的commit点</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout main</span><br><span class="line"></span><br><span class="line">git fetch origin main &amp;&amp; git pull origin main</span><br></pre></td></tr></table></figure><p>创建版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx standard-version -r patch -p alpha</span><br></pre></td></tr></table></figure><p><strong>6. 发布</strong></p><p>推送commit 与 git-tag 到远端git仓库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin main &amp;&amp; git push --tags</span><br></pre></td></tr></table></figure><p>发布到 npm</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录</span></span><br><span class="line">npm login</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发布</span></span><br><span class="line">npm publish --tag alpha</span><br></pre></td></tr></table></figure><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="Husky支持的-Git-hook"><a href="#Husky支持的-Git-hook" class="headerlink" title="Husky支持的 Git hook"></a>Husky支持的 Git hook</h2><p>Husky 支持大部分 Git hook，以下是 Husky 支持的 Git hook 列表：</p><ul><li><code>applypatch-msg</code>：在 Git 执行 <code>git am</code> 命令时触发</li><li><code>pre-applypatch</code>：在 Git 执行 <code>git am</code> 命令前触发</li><li><code>post-applypatch</code>：在 Git 执行 <code>git am</code> 命令后触发</li><li><code>pre-commit</code>：在 Git 执行 <code>git commit</code> 命令前触发</li><li><code>prepare-commit-msg</code>：在 Git 执行 <code>git commit</code> 命令前触发，用于编辑提交信息</li><li><code>commit-msg</code>：在 Git 执行 <code>git commit</code> 命令后触发，用于验证提交信息</li><li><code>post-commit</code>：在 Git 执行 <code>git commit</code> 命令后触发</li><li><code>pre-rebase</code>：在 Git 执行 <code>git rebase</code> 命令前触发</li><li><code>post-checkout</code>：在 Git 执行 <code>git checkout</code> 命令后触发</li><li><code>post-merge</code>：在 Git 执行 <code>git merge</code> 命令后触发</li><li><code>pre-push</code>：在 Git 执行 <code>git push</code> 命令前触发</li><li><code>pre-receive</code>：在 Git 执行 <code>git push</code> 命令时，服务端接收到数据之前触发</li><li><code>update</code>：在 Git 执行 <code>git push</code> 命令时，服务端接收到数据之后触发</li><li><code>post-receive</code>：在 Git 执行 <code>git push</code> 命令后触发</li><li><code>post-update</code>：在 Git 执行 <code>git push</code> 命令后触发</li><li><code>pre-auto-gc</code>：在 Git 执行自动垃圾回收之前触发</li><li><code>post-rewrite</code>：在 Git 执行 <code>git filter-branch</code> 和 <code>git commit --amend</code> 命令后触发</li><li><code>sendemail-validate</code>：在 Git 执行 <code>git send-email</code> 命令前触发</li></ul><p>以上 Git hook 具体作用可以参考 Git 的官方文档。Husky 可以通过在 package.json 文件的 <code>husky.hooks</code> 中定义相应的命令，来自动触发这些 Git hook。例如，在 <code>husky.hooks</code> 中定义 <code>pre-commit</code> 命令，就可以在每次执行 <code>git commit</code> 命令时自动触发该命令。</p><h2 id="post-merge-钩子触发prompt失败"><a href="#post-merge-钩子触发prompt失败" class="headerlink" title="post-merge 钩子触发prompt失败"></a>post-merge 钩子触发prompt失败</h2><p>配置 post-merge 钩子，合并开发分支后触发版本更新逻辑。版本管理选择使用 <code>@isubo-org/version</code>，它是prompt工具，选择的方式设定新版号。</p><p><em>配置 post-merge 钩子</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/post-merge  &#x27;npm run post-merge&#x27;</span><br></pre></td></tr></table></figure><p><em>配置post-merge脚本</em></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;post-merge&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npx isubo-version&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>测试结果是：行不通！</p><p>合并后确实可以触发脚本，但是完全跳过选择流程</p><p><img src="Snipaste_2023-08-07_00-58-17.png"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a target="_blank" rel="noopener" href="https://git-scm.com/docs/githooks#_commit_msg">githooks - Hooks used by Git</a></li><li><a target="_blank" rel="noopener" href="https://docs.npmjs.com/cli/v9/using-npm/scripts">How npm handles the “scripts” field</a></li><li><a target="_blank" rel="noopener" href="https://commitlint.js.org/#/reference-configuration?id=configuration">Commitlint &gt; Configuration</a></li><li><a target="_blank" rel="noopener" href="https://docs.npmjs.com/cli/v9/commands/npx">Npx | Run a command from a local or remote npm package</a></li><li><a target="_blank" rel="noopener" href="https://typicode.github.io/husky/">Husky | Modern native git hooks made easy</a></li><li><a target="_blank" rel="noopener" href="https://commitlint.js.org/#/">Commitlint | Helps your team adhere to a commit convention</a></li></ul></div><footer class="post-footer"><div class="reward-container"><div>Buy me a coffee</div><button>赞赏</button><div class="post-reward"><div><img src="/blog/images/wechatpay.jpg" alt="Isaac Kam 微信"> <span>微信</span></div><div><img src="/blog/images/alipay.jpg" alt="Isaac Kam 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>Isaac Kam</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/" title="自动化CHANGELOG，持续集成">https://isaaxite.github.io/blog/resources/Automated-Changelog-Manual/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><span>欢迎关注我的其它发布渠道</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="https://www.zhihu.com/people/issac-79"><span class="icon"><i class="fab | fa-zhihu"></i> </span><span class="label">Zhihu</span></a></div><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i> </span><span class="label">WeChat</span> </span><img class="social-item-img" src="/blog/images/wechat_qrcode.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/blog/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="https://github.com/isaaxite"><span class="icon"><i class="fab fa-github"></i> </span><span class="label">GitHub</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="isaacgun:isaacgun@outlook.com"><span class="icon"><i class="fa fa-envelope"></i> </span><span class="label">E-Mail</span></a></div></div></div><div class="post-tags"><a href="/blog/tags/CHANGELOG/" rel="tag"><i class="fa fa-tag"></i> CHANGELOG</a> <a href="/blog/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 自动化</a> <a href="/blog/tags/Commit%E8%A7%84%E8%8C%83/" rel="tag"><i class="fa fa-tag"></i> Commit规范</a> <a href="/blog/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" rel="tag"><i class="fa fa-tag"></i> 版本控制</a> <a href="/blog/tags/Git-Hook/" rel="tag"><i class="fa fa-tag"></i> Git Hook</a></div><div class="post-nav"><div class="post-nav-item"><a href="/blog/resources/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%89%A9%E5%B1%95%E7%A8%8B%E5%BA%8F/" rel="prev" title="一次性搞懂浏览器扩展程序开发"><i class="fa fa-chevron-left"></i> 一次性搞懂浏览器扩展程序开发</a></div><div class="post-nav-item"><a href="/blog/resources/Get-Start-Of-Github-Action/" rel="next" title="Github Action 入门指南">Github Action 入门指南 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Isaac Kam</span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/blog/js/third-party/search/local-search.js"></script><script src="/blog/js/third-party/fancybox.js"></script><script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"isaaxite/blog","issue_term":"title","theme":"github-light"}</script><script src="/blog/js/third-party/comments/utterances.js"></script></body></html>