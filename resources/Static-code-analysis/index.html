<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png"><link rel="mask-icon" href="/blog/images/logo.svg" color="#222"><meta name="google-site-verification" content="D3uaiX9T8gcr1zBjqu9y67t-0DhGNCa7yyjpQ27T_Co"><meta name="msvalidate.01" content="AFD16F68B2DF363759600CB5E8825AEC"><link rel="stylesheet" href="/blog/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha256-Z1K5uhUaJXA7Ll0XrZ/0JhX4lAtZFpT6jkKrEDT0drU=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"isaaxite.github.io","root":"/blog/","images":"/blog/images","scheme":"Gemini","darkmode":false,"version":"8.14.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/blog/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog/js/config.js"></script><meta name="description" content="Static code analysis"><meta property="og:type" content="article"><meta property="og:title" content="Static code analysis"><meta property="og:url" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/index.html"><meta property="og:site_name" content="Isaac Kam&#39;s Blog"><meta property="og:description" content="Static code analysis"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-30_10-02-04.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/eslint-init.gif"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-24_02-40-55.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-24_10-05-38.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-24_05-44-28.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-24_10-06-16.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-26_18-37-50.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-26_18-51-04.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-27_02-21-07.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-27_02-28-03.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-27_10-56-23.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-27_10-59-57.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Dependency%20cruiser.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Rollup%20Plugin%20Visualizer.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-30_17-35-51.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-30_17-36-22.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-30_17-37-14.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/dependency-cruiser_init.gif"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-30_20-27-01.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-30_20-37-11.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-31_15-30-56.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-31_15-55-07.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-31_15-58-54.png"><meta property="og:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-31_19-11-09.png"><meta property="article:published_time" content="2023-08-21T03:08:54.000Z"><meta property="article:modified_time" content="2025-03-07T23:26:45.842Z"><meta property="article:author" content="Isaac Kam"><meta property="article:tag" content="writting"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://isaaxite.github.io/blog/resources/Static-code-analysis/Snipaste_2023-08-30_10-02-04.png"><link rel="canonical" href="https://isaaxite.github.io/blog/resources/Static-code-analysis/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://isaaxite.github.io/blog/resources/Static-code-analysis/","path":"resources/Static-code-analysis/","title":"Static code analysis"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Static code analysis | Isaac Kam's Blog</title><noscript><link rel="stylesheet" href="/blog/css/noscript.css"></noscript><link rel="alternate" href="/blog/atom.xml" title="Isaac Kam's Blog" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/blog/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Isaac Kam's Blog</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">I am a slow walker, but I never walk backwards.</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/blog/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li><li class="menu-item menu-item-rss"><a href="/blog/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%91%98%E8%A6%81"><span class="nav-text">摘要</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-text">静态代码分析</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E6%9E%84%E6%88%90"><span class="nav-text">内容构成</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9E%E8%B7%B5%E8%83%8C%E6%99%AF"><span class="nav-text">实践背景</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F"><span class="nav-text">系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE"><span class="nav-text">项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-text">目录结构</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="nav-text">分析工具</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%89%E5%9E%8B"><span class="nav-text">选型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ESLint"><span class="nav-text">ESLint</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">初始化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%AB%E6%8F%8F%E4%BB%A3%E7%A0%81"><span class="nav-text">扫描代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%A8%E9%87%8F%E6%8A%A5%E5%91%8A"><span class="nav-text">质量报告</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E4%BF%AE%E5%A4%8D"><span class="nav-text">自动修复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B"><span class="nav-text">安全检测</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IDE-%E9%9B%86%E6%88%90"><span class="nav-text">IDE 集成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6%E6%89%A7%E8%A1%8C"><span class="nav-text">强制执行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#git-hook"><span class="nav-text">git-hook</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E6%8A%A5%E5%91%8A"><span class="nav-text">统计报告</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Plato"><span class="nav-text">Plato</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="nav-text">安装与使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">遇到的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%89%A9%E5%B1%95%E5%90%8D"><span class="nav-text">配置文件扩展名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%82%B9%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E5%8F%AF%E9%80%89%E8%AF%AD%E6%B3%95"><span class="nav-text">点操作符的可选语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Plato%E6%8A%A5%E5%91%8A%E6%A6%82%E8%BF%B0"><span class="nav-text">Plato报告概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0"><span class="nav-text">最终实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Palto-%E6%8A%A5%E5%91%8A"><span class="nav-text">Palto 报告</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88-Eslint"><span class="nav-text">组合 Eslint</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-1"><span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%88%86%E6%9E%90"><span class="nav-text">依赖分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%B7%A5%E5%85%B7"><span class="nav-text">常见工具</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Rollup-Plugin-Visualizer"><span class="nav-text">Rollup Plugin Visualizer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-1"><span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%9B%BE%E8%A1%A8"><span class="nav-text">生成图表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dependency-cruiser"><span class="nav-text">Dependency cruiser</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-text">安装与配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E6%8A%A5%E5%91%8A"><span class="nav-text">生成报告</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E6%88%90%E5%88%B0-IDE"><span class="nav-text">集成到 IDE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-3"><span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0-1"><span class="nav-text">最终实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93-4"><span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%99%84%E5%BD%95"><span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-text">参考</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Isaac Kam" src="/blog/images/avatar.jpg"><p class="site-author-name" itemprop="name">Isaac Kam</p><div class="site-description" itemprop="description"></div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/blog/archives/"><span class="site-state-item-count">64</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/blog/categories/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/blog/tags/"><span class="site-state-item-count">92</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/isaaxite" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;isaaxite" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="isaacgun:isaacgun@outlook.com" title="E-Mail → isaacgun:isaacgun@outlook.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://isaaxite.github.io/blog/resources/Static-code-analysis/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/blog/images/avatar.jpg"><meta itemprop="name" content="Isaac Kam"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Isaac Kam's Blog"><meta itemprop="description" content=""></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Static code analysis | Isaac Kam's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Static code analysis</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-08-21 11:08:54" itemprop="dateCreated datePublished" datetime="2023-08-21T11:08:54+08:00">2023-08-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-03-08 07:26:45" itemprop="dateModified" datetime="2025-03-08T07:26:45+08:00">2025-03-08</time></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><h1 id="静态代码分析"><a href="#静态代码分析" class="headerlink" title="静态代码分析"></a>静态代码分析</h1><p>静态代码分析指的是在不实际执行代码的情况下，对源代码进行分析，并识别潜在问题、漏洞或代码质量违规。它是在持续集成和持续部署（CI&#x2F;CD）流程中进行代码分析的自动化方法。</p><p>静态代码分析工具会检查各种编程语言的源代码，检查常见的编码错误、安全漏洞、遵循编码规范和其他最佳实践。这些工具可以检测语法错误、未使用的变量、代码重复、潜在的安全漏洞以及遵循编码风格指南等问题。</p><p>通过将静态代码分析集成到 CI&#x2F;CD 流程中，开发人员可以及早发现并解决代码问题。这有助于提高代码质量、可维护性和安全性，通过在代码进入生产环境之前识别和修复问题。</p><h1 id="内容构成"><a href="#内容构成" class="headerlink" title="内容构成"></a>内容构成</h1><p>静态代码分析的实践主要包括以下几个部分:</p><ol><li><p>语法检查：静态代码分析工具应该能够对 JavaScript 代码进行语法检查，确保代码符合语言规范，避免常见的语法错误。</p></li><li><p>代码规范检查：静态代码分析工具可以应用各种规范（如ESLint、JSLint等）来检查代码的风格和规范是否符合约定。这包括缩进、命名约定、注释风格等。</p></li><li><p>代码质量评估：静态代码分析工具应该能够评估代码的质量，包括代码复杂性、重复代码等方面。这些评估可以帮助开发者发现潜在的问题，改进代码结构和性能。</p></li><li><p>依赖关系分析：对于 JavaScript 项目而言，依赖关系管理是重要的一部分。静态代码分析工具可以分析项目的依赖关系，检查依赖的版本、冲突和安全漏洞，并提供相关建议。</p></li><li><p>安全漏洞检测：静态代码分析工具应该能够检测 JavaScript 代码中的常见安全漏洞，如跨站脚本攻击（XSS）、SQL 注入、不安全的数据处理等，并提供修复建议。</p></li><li><p>性能优化建议：静态代码分析工具应该能够分析代码并提供性能优化的建议，帮助开发者改善代码的执行效率、减少资源消耗等。</p></li><li><p>异步代码分析：JavaScript 中的异步编程是常见的模式之一。静态代码分析工具应该能够处理和分析异步代码，以检测可能的异步错误、回调地狱和资源竞争等问题。</p></li><li><p>可读性和一致性评估：良好的代码可读性和一致性对于维护和团队协作至关重要。静态代码分析工具应该能够评估代码的可读性和一致性，并提供有关代码风格、命名规范等方面的建议。</p></li></ol><p>这些能力使得静态代码分析工具成为 JavaScript 开发中有力的辅助工具，可以帮助开发者提高代码质量、发现潜在问题，并改进代码风格和实践。常见的静态代码分析工具包括 ESLint、JSHint、JSLint、TSLint 等。</p><h1 id="实践背景"><a href="#实践背景" class="headerlink" title="实践背景"></a>实践背景</h1><h2 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h2><p>WSL2 - Debian 12</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> /etc/os-release</span></span><br><span class="line">PRETTY_NAME=&quot;Debian GNU/Linux 12 (bookworm)&quot;</span><br><span class="line">NAME=&quot;Debian GNU/Linux&quot;</span><br><span class="line">VERSION_ID=&quot;12&quot;</span><br><span class="line">VERSION=&quot;12 (bookworm)&quot;</span><br><span class="line">VERSION_CODENAME=bookworm</span><br><span class="line">ID=debian</span><br><span class="line">HOME_URL=&quot;https://www.debian.org/&quot;</span><br><span class="line">SUPPORT_URL=&quot;https://www.debian.org/support&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.debian.org/&quot;</span><br></pre></td></tr></table></figure><h2 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h2><p>下面将使用 <a target="_blank" rel="noopener" href="https://github.com/isaaxite/deploy-posts-to-github-issue">deploy-posts-to-github-issue</a> 作为实践的项目，期间部分实践内容会以此项目的克隆作为载体实现。</p><p><a target="_blank" rel="noopener" href="https://github.com/isaaxite/deploy-posts-to-github-issue"><img src="Snipaste_2023-08-30_10-02-04.png"></a></p><ul><li><p>模块打包器：rollup</p></li><li><p>测试框架：jest</p></li><li><p>其他：</p><ul><li>husky：是一个用于在 Git 提交和推送前执行脚本的工具，帮助开发者在关键事件发生前自动运行定制化的操作和脚本。</li></ul></li></ul><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">deploy-posts-to-github-issue</span><br><span class="line">├── assets</span><br><span class="line">├── bin</span><br><span class="line">├── CHANGELOG.md</span><br><span class="line">├── commitlint.config.js</span><br><span class="line">├── dist</span><br><span class="line">├── index.js</span><br><span class="line">├── inspiration-flash.md</span><br><span class="line">├── jest.config.mjs</span><br><span class="line">├── jest.dev.config.mjs</span><br><span class="line">├── jest.js</span><br><span class="line">├── lib</span><br><span class="line">├── LICENSE</span><br><span class="line">├── MANUAL.md</span><br><span class="line">├── package.json</span><br><span class="line">├── pnpm-lock.yaml</span><br><span class="line">├── README.md</span><br><span class="line">├── reports</span><br><span class="line">├── rollup.config.js</span><br><span class="line">├── scripts</span><br><span class="line">└── __test__</span><br></pre></td></tr></table></figure><p>核心代码目录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bin/</span><br><span class="line">  └── index.js</span><br><span class="line"></span><br><span class="line">lib/</span><br><span class="line">  ├── asset_finder.js</span><br><span class="line">  ├── asset_publisher.js</span><br><span class="line">  ├── conf_reader.js</span><br><span class="line">  ├── constants</span><br><span class="line">  │   ├── asset.js</span><br><span class="line">  │   ├── enum.js</span><br><span class="line">  │   └── index.js</span><br><span class="line">  ├── hinter.js</span><br><span class="line">  ├── link_formater.js</span><br><span class="line">  ├── md_frontmatter.js</span><br><span class="line">  ├── post_finder.js</span><br><span class="line">  ├── post_manager.js</span><br><span class="line">  ├── post_parse.js</span><br><span class="line">  ├── post_path.js</span><br><span class="line">  └── utils</span><br><span class="line">      ├── common.js</span><br><span class="line">      ├── error.js</span><br><span class="line">      └── index.js</span><br></pre></td></tr></table></figure><h1 id="分析工具"><a href="#分析工具" class="headerlink" title="分析工具"></a>分析工具</h1><h2 id="选型"><a href="#选型" class="headerlink" title="选型"></a>选型</h2><table><thead><tr><th>工具</th><th>描述</th><th>提出时间</th><th>GitHub Star 数量</th></tr></thead><tbody><tr><td><a target="_blank" rel="noopener" href="https://eslint.org/">ESLint</a></td><td>可配置的 JavaScript&#x2F;JS 代码检查工具和静态分析器，替代 JSHint，提供更大的灵活性和可配置性</td><td>2013年</td><td>23.3k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://jshint.com/">JSHint</a></td><td>JavaScript&#x2F;JS 的静态代码分析工具，支持可定制的规则，延续 JSLint 的思想，提供更好的可定制性和适应性</td><td>2011年</td><td>8.9k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://palantir.github.io/tslint/">TSLint</a></td><td>针对 TypeScript 的静态代码分析工具，已被 ESLint 取代，提供静态代码检查和规范性的支持</td><td>2012年</td><td>5.9k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://www.typescriptlang.org/">TypeScript</a></td><td>JavaScript 的超集，带有静态类型检查和编译时静态代码分析能力，提供更严格的类型检查和更好的 IDE 支持，增强 JavaScript 开发环境的可靠性</td><td>2012年</td><td>93.5k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://flow.org/">Flow</a></td><td>Facebook 开发的 JavaScript&#x2F;JS 静态类型检查器，为 JavaScript 开发者提供静态类型检查，提高代码质量和可维护性</td><td>2014年</td><td>22k</td></tr></tbody></table><p>从功能性与和流行趋势，TSLint 和 JSHint 已经被 ESLint 替代。而 TypeScript，与其说它是静态代码分析的工具，不如说它是个类似JS的语言。当然它具备静态代码分析的能力，但如果已经开发到一定程度的项目所使用的开发语言是JS的话，使用TS的会有不小的迁移成本！</p><p>剩下的是 ESLint 和 Flow，它们提出时间和流行程度都差不多。不妨针对它们做一下对比分析。</p><p>下面是使用表格对比 ESLint 和 Flow 的功能：</p><table><thead><tr><th>功能</th><th>ESLint</th><th>Flow</th></tr></thead><tbody><tr><td>代码检查</td><td>✔️</td><td>✔️</td></tr><tr><td>类型检查</td><td>❌</td><td>✔️</td></tr><tr><td>静态类型推断</td><td>❌</td><td>✔️</td></tr><tr><td>编译时类型检查</td><td>❌</td><td>✔️</td></tr><tr><td>支持 JavaScript</td><td>✔️</td><td>✔️</td></tr><tr><td>支持 TypeScript</td><td>✔️</td><td>❌</td></tr><tr><td>可配置性</td><td>高</td><td>中</td></tr><tr><td>社区支持</td><td>大型活跃社区，广泛的插件和扩展库可用</td><td>较小的社区，插件和扩展库相对较少</td></tr><tr><td>IDE 集成</td><td>广泛支持，与许多主流编辑器（如 VS Code、Sublime Text）集成良好</td><td>有限的 IDE 集成，可能不如 ESLint 的支持广泛和完善</td></tr><tr><td>项目可移植性</td><td>高</td><td>较低，Flow 的类型注释和配置文件需要进行迁移和调整才能与其他工具兼容</td></tr></tbody></table><p>需要注意的是，ESLint 和 Flow 在某些功能上有所重叠，但也有一些区别。ESLint 主要关注代码规范和质量检查，而 Flow 则专注于静态类型检查和类型推断。ESLint 的可配置性和社区支持相对较高，适用于 JavaScript 和 TypeScript 项目，并与各种编辑器集成良好。Flow 在类型检查和静态类型推断方面表现出色，但它的社区支持相对较小，与编辑器的集成程度可能不如 ESLint 那么广泛。此外，如果要将项目从 Flow 迁移到其他工具或框架，可能需要进行一些调整和改动。</p><h2 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h2><p>ESLint 是一个用于检查和规范 JavaScript 代码的开源工具。它可以帮助开发者在编写代码时发现潜在的问题、遵循一致的代码风格，并提供自定义的代码规则。ESLint 具有高度可配置性和灵活性，可以适应不同项目和团队的需求。</p><p>以下是 ESLint 的一些主要特点和功能：</p><ol><li><p>代码规范检查： ESLint 可以静态地分析 JavaScript 代码，并根据预定义的规则集检查代码是否符合规范。它可以发现常见的错误、潜在的问题和不一致之处，如未声明的变量、使用未定义的函数、潜在的歧义等。</p></li><li><p>可配置性： ESLint 具有高度的可配置性，允许开发者根据项目需求和团队的代码风格指南自定义规则。你可以启用、禁用或修改规则，并设置不同的错误级别（警告或错误）。此外，ESLint 还支持配置文件的继承和共享，以便在多个项目中共享和重用配置。</p></li><li><p>插件和扩展： ESLint 具有丰富的插件生态系统，可以通过插件扩展其功能。插件可以添加额外的规则、支持其他文件类型（如 TypeScript、Vue 等），或提供特定框架或库的规则集。通过安装和配置这些插件，你可以在 ESLint 中使用更多的规则和功能。</p></li><li><p>自动修复问题： ESLint 具备自动修复问题的能力，可以通过 –fix 标志自动修复一些常见的问题，如不一致的缩进、缺少分号等。这样可以减轻开发者手动修复问题的负担，并提高代码的一致性。</p></li><li><p>与编辑器和构建工具的集成： ESLint 可以与各种编辑器和构建工具集成，以提供实时的代码检查和反馈。大多数编辑器都支持 ESLint 插件，可以在保存文件时自动运行 ESLint，并在编辑器中显示错误和警告。此外，ESLint 还可以与构建工具（如 webpack、gulp 等）集成，以便在构建过程中进行代码检查。</p></li></ol><p>ESLint 是一个非常强大和流行的工具，被广泛用于 JavaScript 项目中。它可以帮助开发团队保持一致的代码风格、规范代码质量，并提高代码的可读性和可维护性。通过使用 ESLint，开发者可以在早期发现和解决潜在的问题，提高代码的可靠性和稳定性。</p><p>eslint 对代码静态分析实践的部分：</p><ul><li><p>语法检查；</p></li><li><p>代码规范检查；</p></li><li><p>代码质量评估；</p></li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add --save-dev eslint</span><br></pre></td></tr></table></figure><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>使用 eslint 提供的能力进行初始化。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm init @eslint/config</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">~ or ~</span></span><br><span class="line">npx eslint --init</span><br></pre></td></tr></table></figure><p><img src="eslint-init.gif"></p><p>上面 init 命令分别做了下面几件事：</p><ul><li><p>配置 Eslint 的能力范围，prompt 提供三个选项：</p><ol><li>仅作代码检查；</li><li>代码检查与反馈问题；</li><li>代码检查、反馈问题以及格式化。</li></ol></li><li><p>指定模块风格：</p><ol><li>JavaScript modules；</li><li>CommonJS；</li><li>不设置。</li></ol></li><li><p>选择框架，目前会提供 <code>Reat</code> 和 <code>Vue</code> 或者不设置；</p></li><li><p>配置是否使用了 TypeScript；</p></li><li><p>配置项目的运行时，Node 或 浏览器（但貌似有 Bug）；</p></li><li><p>选择代码风格的配置方式，提供下面两种方式：</p><ol><li>先择现成的解决方案；</li><li>自定义配置；</li></ol></li></ul><p><img src="Snipaste_2023-08-24_02-40-55.png"></p><p>在初始化过程中，需要我们选择 Eslint 代码风格。在 Prompt 中可以看到有 Airbnb、Standard，Google 和 XO 四种提供。下面以表格的形式对四种规范做简短说明。</p><table><thead><tr><th>代码规范</th><th>特点</th><th>缩进</th><th>引号</th><th>分号</th><th>严格相等和不严格相等</th><th>对象字面量属性排序</th><th>Github Star</th></tr></thead><tbody><tr><td><a target="_blank" rel="noopener" href="https://github.com/airbnb/javascript">Airbnb</a></td><td>- 强调代码的可读性和一致性<br>- 鼓励使用现代的JavaScript语言特性和最佳实践<br>- 包括对代码风格、命名约定、缩进、注释等的建议<br>- 要求使用ES6及以上版本的JavaScript并强制一些严格的规则</td><td>2 个空格</td><td>单引号</td><td>可选</td><td>推荐使用</td><td>推荐排序</td><td>136k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/standard/standard">Standard</a></td><td>- 简洁明了的JavaScript代码规范<br>- 减少代码样式的争议<br>- 鼓励一种统一的代码风格<br>- 使用两个空格的缩进、禁止使用分号等的具体规则<br>- 遵循ES5的语法</td><td>2 个空格</td><td>单引号</td><td>禁止</td><td>推荐使用</td><td>推荐排序</td><td>28.4k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/google/eslint-config-google">Google</a></td><td>- Google公司内部广泛使用的规范<br>- 强调可读性、可维护性和性能<br>- 提供了详细的代码编写指南<br>- 支持ES5和ES6语法<br>- 提供一些特定于Google编码风格的规则</td><td>2 个空格</td><td>双引号</td><td>强制</td><td>推荐使用</td><td>推荐排序</td><td>1.7k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/xojs/eslint-config-xo">XO</a></td><td>- 具有严格规则集的JavaScript代码规范和代码检查工具<br>- 基于ESLint构建<br>- 提供零配置的规范<br>- 强制执行高级规则，如使用ES6模块、禁止使用<code>console</code>等<br>- 提供可选的规则来适应不同的开发需求</td><td>2 个空格</td><td>单引号</td><td>禁止</td><td>推荐使用</td><td>推荐排序</td><td>248</td></tr></tbody></table><p>请注意，以上表格只列出了一些主要的规范特点，并不能穷尽所有规范的细节。对于更详细的规范内容和具体规则，建议查阅各自的官方文档或 GitHub 仓库。选择适合自己或团队的代码规范时，可以深入研究每个规范的详细规则，并根据实际需求进行定制。</p><p>在 init 的过程中选择了 airbnb。airbnb发布的ESLint配置规则广为人知,我们可以从以下几个方面对其规则进行分类:</p><ul><li><p><strong>代码质量</strong>：包含无用代码检测、最佳实践、复杂度限制等,如no-unused-vars、no-implicit-globals、complexity等。</p></li><li><p><strong>错误防范</strong>：包含可能导致错误的代码模式检测,如no-console、no-debugger、no-alert等。</p></li><li><p><strong>风格统一</strong>：包含代码风格方面的规则,强制一致的代码风格,如quotes、indent、space-before-function-paren等。</p></li><li><p><strong>ES6优先</strong>：包含优先使用ES6新特性的规则,如prefer-const、prefer-rest-params、prefer-spread等。</p></li><li><p><strong>浏览器环境</strong>：包含针对浏览器环境的规则,如no-restricted-globals、no-alert等。</p></li><li><p><strong>Node.js环境</strong>：包含针对Node.js环境的规则,如handle-callback-err、no-mixed-requires等。</p></li><li><p><strong>规范与习惯</strong>：根据通用代码编写规范制定的规则,如camelcase、new-cap、curly等。</p></li><li><p><strong>可读性</strong>：关注代码可读性的规则,如max-len、max-lines、max-params等。</p></li><li><p><strong>变量声明</strong>：规范变量声明方式的规则,如no-var、prefer-const等。</p></li></ul><p>以上分类让我们更直观地看到airbnb规则的覆盖面和侧重点。</p><p>初始化完成后，会得到如下的配置文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.cjs</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">env</span>: &#123;</span><br><span class="line">    <span class="attr">browser</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">es2021</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">extends</span>: <span class="string">&#x27;airbnb-base&#x27;</span>,</span><br><span class="line">  <span class="attr">overrides</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">env</span>: &#123;</span><br><span class="line">        <span class="attr">node</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">files</span>: [</span><br><span class="line">        <span class="string">&#x27;.eslintrc.&#123;js,cjs&#125;&#x27;</span>,</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">        <span class="attr">sourceType</span>: <span class="string">&#x27;script&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">parserOptions</span>: &#123;</span><br><span class="line">    <span class="attr">ecmaVersion</span>: <span class="string">&#x27;latest&#x27;</span>,</span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&#x27;module&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>其中 env 的配置与上面 init 过程中选择运行时明显不同，下面手动修改为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">env</span>: &#123;</span><br><span class="line">  <span class="attr">browser</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">node</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">es2021</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>下面对生成的配置文件中几个配置项做简单说明：</p><ul><li><p><code>env</code>：指定代码运行的环境，如浏览器环境 (browser)、Node.js 环境 (node) 等；</p></li><li><p><code>extends</code>：引用其他配置文件或扩展，可以是已经定义好的配置（如 airbnb-base）、共享配置（如 eslint:recommended）或自定义的配置；</p></li><li><p><code>globals</code>：定义全局变量，避免因为全局变量未定义而产生警告；</p></li><li><p><code>parser</code>：指定代码解析器，例如 Babel 解析器 (babel-eslint) 或 TypeScript 解析器 (@typescript-eslint&#x2F;parser)；</p></li><li><p><code>parserOptions</code>：指定解析器选项，如 ECMAScript 版本 (ecmaVersion)、源代码类型 (sourceType)、额外的语言特性支持等；</p></li><li><p><code>plugins</code>：加载并使用 ESLint 插件，扩展额外的规则和功能；</p></li><li><p><code>rules</code>：定义规则，用于检查和强制执行代码的编码规范，可以启用、禁用、配置规则的错误级别等；</p></li><li><p><code>overrides</code>：允许对特定文件或文件类型进行额外的配置，可以覆盖全局配置；</p></li></ul><p>ESLint 常用的插件包括:</p><ul><li><p><a target="_blank" rel="noopener" href="https://github.com/jsx-eslint/eslint-plugin-react">eslint-plugin-react</a> - 检查 React 代码,支持 JSX 语法等。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/vuejs/eslint-plugin-vue">eslint-plugin-vue</a> - 检查 Vue 代码,支持 *.vue 文件。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/Gillespie59/eslint-plugin-angular">eslint-plugin-angular</a> - 检查 Angular 代码,支持指令、模块等特性。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/jquery/eslint-plugin-jquery">eslint-plugin-jquery</a> - 检查 jQuery 代码。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/mysticatea/eslint-plugin-node">eslint-plugin-node</a> - 添加Node.js环境下的JavaScript代码检查。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/benmosher/eslint-plugin-import">eslint-plugin-import</a> - 检查ES6+ 的 import&#x2F;export 语法。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/jsx-eslint/eslint-plugin-jsx-a11y">eslint-plugin-jsx-a11y</a> - 辅助检查JSX元素的可访问性。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/xjamundx/eslint-plugin-promise">eslint-plugin-promise</a> - 添加Promise相关的规则。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/standard/eslint-plugin-standard">eslint-plugin-standard</a> - 实现standard代码风格的规则。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/BenoitZugmeyer/eslint-plugin-html">eslint-plugin-html</a> - 检查HTML文件中的JavaScript代码。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/eslint/eslint-plugin-markdown">eslint-plugin-markdown</a> - 检查Markdown文件中的代码。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/amilajack/eslint-plugin-compat">eslint-plugin-compat</a> - 检查浏览器兼容性问题。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/jest-community/eslint-plugin-jest">eslint-plugin-jest</a> - 检查Jest测试框架的代码。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/typescript-eslint/typescript-eslint">eslint-plugin-typescript</a> - 添加TypeScript语法支持。</p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/eslint-community/eslint-plugin-security">eslint-plugin-security</a> - 用于检测 JavaScript 代码中的潜在安全漏洞。它提供了一系列规则，用于查找并警告可能导致安全问题的代码模式。</p></li></ul><p>通过使用不同的插件可以大大扩展ESLint的功能范围,适应不同的项目需求。</p><h2 id="扫描代码"><a href="#扫描代码" class="headerlink" title="扫描代码"></a>扫描代码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx eslint ./lib/ ./bin/</span><br></pre></td></tr></table></figure><p><img src="Snipaste_2023-08-24_10-05-38.png"></p><h2 id="质量报告"><a href="#质量报告" class="headerlink" title="质量报告"></a>质量报告</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx eslint ./lib ./bin --format=html --output-file=reports/eslint-report.html</span><br></pre></td></tr></table></figure><p>使用 anywhere 启动 http 服务:</p><p><img src="Snipaste_2023-08-24_05-44-28.png"></p><p>其他支持的输出的格式：</p><ul><li><p>checkstyle：以 Checkstyle XML 格式输出，适合与其他工具集成；</p></li><li><p>compact：以紧凑的格式输出，适合在终端上显示；</p></li><li><p>html：以 HTML 格式输出，适合在浏览器中查看；</p></li><li><p>jslint-xml：以 JSLint XML 格式输出，适合与其他工具集成；</p></li><li><p>json-with-metadata：以 JSON 格式输出，包含元数据信息；</p></li><li><p>json：以纯 JSON 格式输出；</p></li><li><p>junit：以 JUnit XML 格式输出，适合与持续集成工具集成；</p></li><li><p>stylish：以类似于代码样式的格式输出，适合在终端上显示；</p></li><li><p>tap：以 TAP（Test Anything Protocol）格式输出，适合与测试框架集成；</p></li><li><p>unix：以类 Unix 风格的格式输出，适合在终端上显示；</p></li><li><p>visualstudio：以 Visual Studio Code 的问题报告格式输出，适合在编辑器中显示。</p></li></ul><h2 id="自动修复"><a href="#自动修复" class="headerlink" title="自动修复"></a>自动修复</h2><p>使用 <code>--fix</code> 可选项修复部分问题。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx eslint --fix ./lib/ ./bin/</span><br></pre></td></tr></table></figure><p>修复后的报告见下。对比前面的报告，eslint 修复了大部分问题，但实际上 eslint 尽可以修复部分类型的问题。</p><p>以下是一些常见的 ESLint 可以自动修复的问题类型：</p><ul><li><p>格式问题：例如缩进、空格、换行等方面的问题可以通过自动修复功能进行修复；</p></li><li><p>引号问题：例如单引号和双引号之间的一致性问题可以自动修复；</p></li><li><p>无用代码：例如未使用的变量、未使用的导入等可以通过自动修复进行删除；</p></li><li><p>标准化问题：例如统一函数命名、统一变量命名等可以通过自动修复进行标准化；</p></li><li><p>基本语法问题：例如缺少分号、多余的逗号等可以通过自动修复进行修复。</p></li></ul><p><img src="Snipaste_2023-08-24_10-06-16.png"></p><p>在了解自动修复的相关内容时，另一款据说相较 Eslint 更强的工具，prettier 出现在我的视线。</p><p>根据 prettier 的文档（<a target="_blank" rel="noopener" href="https://prettier.io/docs/en/integrating-with-linters">Integrating with Linters</a>）指引安装了扩展（eslint-config-prettier）和插件（eslint-plugin-prettier）。最终修过没有达到预期，剩下大部分问题依然无法自动格式化，下面是使用 prettier 前（左）后（右）的对比：</p><p><img src="Snipaste_2023-08-26_18-37-50.png"></p><ul><li><p>使用后，问题从162个减少到153个，共11个；</p></li><li><p>对比后得知，被自动修复的问题是 <code>max-len</code> 类问题（如下）；</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11:1	Error	This line has a length of 105. Maximum allowed is 100.	max-len</span><br></pre></td></tr></table></figure></li></ul><p>根据 ESLint 报告里面的错误信息,可以将检测到的问题分类如下:</p><ol><li>导入语句问题</li></ol><ul><li><p>Unexpected use of file extension “js” for imports: 应该直接导入模块名,不需要添加.js后缀</p></li><li><p>Prefer default export on a file with single export: 当模块只有一个导出时应设置为default导出</p></li></ul><ol start="2"><li>代码质量问题</li></ol><ul><li>no-use-before-define: 在定义前使用变量</li><li>no-nested-ternary: 不要嵌套三元表达式</li><li>no-plusplus: 不要使用++&#x2F;–运算符</li><li>no-restricted-syntax: 不允许使用语法结构generate&#x2F;yield</li></ul><ol start="3"><li>最佳实践问题</li></ol><ul><li>no-param-reassign: 不要修改函数参数</li><li>no-console: 不要使用console语句</li><li>no-alert: 不要使用alert</li></ul><ol start="4"><li>风格问题</li></ol><ul><li>camelcase: 变量名应使用驼峰命名</li><li>max-classes-per-file: 每个文件类的数量不应超过1个</li></ul><ol start="5"><li>可读性问题</li></ol><ul><li>no-magic-numbers: 不要使用难懂的数字常量</li><li>no-nested-ternary: 不要嵌套三元表达式</li></ul><ol start="6"><li>未使用变量问题</li></ol><ul><li>no-unused-vars: 定义后未使用的变量</li></ul><ol start="7"><li>循环问题</li></ol><ul><li>no-loop-func: 循环中不要定义函数</li></ul><p>以上这些问题都是确实 Eslint 和 prettier 无法自动格式化的问题。实际上，EsLint 的官网也有对那些规则无法格式化有做简短说明，可查阅：<a target="_blank" rel="noopener" href="https://eslint.org/docs/latest/rules/">Rules Reference</a>。</p><blockquote><p><img src="Snipaste_2023-08-26_18-51-04.png"></p></blockquote><h2 id="安全检测"><a href="#安全检测" class="headerlink" title="安全检测"></a>安全检测</h2><p>eslint-plugin-security：<a target="_blank" rel="noopener" href="https://github.com/eslint-community/eslint-plugin-security">https://github.com/eslint-community/eslint-plugin-security</a></p><p>ESLint内置对XSS漏洞的检测规则,但是需要安装额外的插件才能启用。</p><p>具体操作如下:</p><ol><li>安装eslint-plugin-security插件</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install eslint-plugin-security</span><br></pre></td></tr></table></figure><ol start="2"><li>在.eslintrc.js配置文件中添加plugins和rules:</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&#x27;security&#x27;</span>],</span><br><span class="line">  </span><br><span class="line">  <span class="attr">rules</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;security/detect-object-injection&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;security/detect-non-literal-fs-filename&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;security/detect-non-literal-regexp&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;security/detect-possible-timing-attacks&#x27;</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="string">&#x27;security/detect-non-literal-require&#x27;</span>: <span class="string">&#x27;off&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>运行ESLint,它会检查可能导致XSS的内容注入风险。</li></ol><p>如变量直接插入到HTML中而未经过滤、模板字符串注入等情况。</p><ol start="4"><li>需要进一步配置白名单或黑名单来去除误报。</li></ol><p>使用这个插件可以在开发阶段及早发现XSS问题,但不可完全替代动态测试。</p><h2 id="IDE-集成"><a href="#IDE-集成" class="headerlink" title="IDE 集成"></a>IDE 集成</h2><p>TODO</p><h2 id="强制执行"><a href="#强制执行" class="headerlink" title="强制执行"></a>强制执行</h2><h3 id="git-hook"><a href="#git-hook" class="headerlink" title="git-hook"></a>git-hook</h3><p>TODO</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul><li><input checked disabled type="checkbox"> 语法检查</li><li><input checked disabled type="checkbox"> 代码规范检查</li><li><input checked disabled type="checkbox"> 代码质量评估</li><li><input disabled type="checkbox"> 依赖关系分析</li><li><input disabled type="checkbox"> 安全漏洞检测</li><li><input disabled type="checkbox"> 性能优化建议</li><li><input disabled type="checkbox"> 异步代码分析</li><li><input disabled type="checkbox"> 可读性和一致性评估</li></ul><h1 id="统计报告"><a href="#统计报告" class="headerlink" title="统计报告"></a>统计报告</h1><h2 id="Plato"><a href="#Plato" class="headerlink" title="Plato"></a>Plato</h2><p>Plato 是一个基于 JavaScript 的代码分析和可视化工具，用于生成代码复杂度报告和可视化图表。它提供了对圈复杂度、函数长度、类复杂度等指标的详细分析和可视化展示。</p><h2 id="安装与使用"><a href="#安装与使用" class="headerlink" title="安装与使用"></a>安装与使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">pnpm add plato --save-dev</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用</span></span><br><span class="line">npx plato -r -d ./reports/plato -e .eslintrc.cjs ./lib ./bin</span><br></pre></td></tr></table></figure><p>这句命令是使用 <code>plato</code> 工具生成代码复杂度报告的命令。它的作用是在指定的目录下分析 JavaScript 文件，并生成递归的代码复杂度报告，报告输出到 <code>./reports/plato</code> 目录。同时，还会使用指定的 ESLint 配置文件进行代码分析。</p><p>下面对命令中的各个部分进行解释：</p><ul><li><p><code>-r</code>: 表示生成递归报告。递归报告会分析指定目录下的所有 JavaScript 文件及其子目录中的文件。</p></li><li><p><code>-d ./reports/plato</code>: <code>-d</code> 是 <code>plato</code> 的一个命令行选项，用于指定报告输出目录。在这个命令中，将报告输出到 <code>./reports/plato</code> 目录。</p></li><li><p><code>-e .eslintrc.cjs</code>: <code>-e</code> 是 <code>plato</code> 的一个命令行选项，用于指定 ESLint 配置文件。在这个命令中，使用 <code>.eslintrc.cjs</code> 文件作为 ESLint 的配置文件。</p></li><li><p><code>./lib ./bin</code>: <code>./lib ./bin</code> 是指定要分析的 JavaScript 文件或目录。在这个命令中，分析 <code>./lib</code> 和 <code>./bin</code> 目录下的 JavaScript 文件。</p></li></ul><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><h3 id="配置文件扩展名"><a href="#配置文件扩展名" class="headerlink" title="配置文件扩展名"></a>配置文件扩展名</h3><p><em>遇到第一个问题：不支持 <code>cjs</code> 扩展名的配置文件，根据提示推断是要求 json 格式的。</em></p><p><img src="Snipaste_2023-08-27_02-21-07.png"></p><p>这个先按下，跳过指定 eslint 的配置文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx plato -r -d ./reports/plato ./lib ./bin</span><br></pre></td></tr></table></figure><p>出现了第二个问题：plato 不支持 ES6+ 的 Class 死有属性语法。时至今日，不支持这个语法，或许可以认为这个工具已经被抛弃。从目前的状况确实是这样，最后一次更新已经是 7 年前！但是它确实目前我可以找到功能比较完备的带质量报告生成工具。</p><p><img src="Snipaste_2023-08-27_02-28-03.png"></p><p>既然是语法的兼容性问题，那就用 babel 做转译兼容。最终目的是在保留目录解构的前提下，做最小程度的兼容：</p><p>安装 babel 相关 pkg：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add --save-dev @babel/core @babel/cli</span><br></pre></td></tr></table></figure><p>添加插件编译私有方法与属性：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pnpm add --save-dev \</span><br><span class="line">  @babel/plugin-transform-class-properties \</span><br><span class="line">  @babel/plugin-transform-private-methods \</span><br><span class="line">  @babel/plugin-transform-private-property-in-object</span><br></pre></td></tr></table></figure><p>配置文件（<code>.babelrc</code>）</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;plugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;@babel/plugin-transform-class-properties&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;@babel/plugin-transform-private-property-in-object&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;@babel/plugin-transform-private-methods&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>编译与生成质量报告：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -rf temp/dist ./reports/plato &amp;&amp; \</span><br><span class="line">  npx babel lib --out-dir temp/dist &amp;&amp; \</span><br><span class="line">  npx plato -r -d ./reports/plato ./temp/dist</span><br></pre></td></tr></table></figure><h3 id="点操作符的可选语法"><a href="#点操作符的可选语法" class="headerlink" title="点操作符的可选语法"></a>点操作符的可选语法</h3><p>出现另外的问题：plato 不支持点操作符的可选语法。安装 <code>@babel/plugin-transform-optional-chaining</code> 插件转译此语法，再此生成报告：</p><p><img src="Snipaste_2023-08-27_10-56-23.png"></p><p>生成 html 格式的质量报告，使用 <code>anywhere</code> 渲染后，在浏览器打开：</p><p><img src="Snipaste_2023-08-27_10-59-57.png"></p><h2 id="Plato报告概述"><a href="#Plato报告概述" class="headerlink" title="Plato报告概述"></a>Plato报告概述</h2><p>Plato 提供了一系列质量指标来评估代码的质量和复杂性。以下是一些常见的 Plato 提供的质量指标：</p><ul><li><p>Lines of Code(LOC) - 源代码总行数。</p></li><li><p>Total Complexity - 整体复杂度评分。增加表示代码整体复杂度上升。</p></li><li><p>Average Complexity - 每个函数的平均复杂度。增加表示每个函数复杂度提高。</p></li><li><p>Function Declarations - 函数声明数量。增加表示函数数增多。</p></li><li><p>Global Variables - 全局变量使用数量。增加表示使用更多全局变量。</p></li><li><p>Cyclomatic Complexity - 圈复杂度。增加表示代码路径增加,逻辑更复杂。</p></li><li><p>Halstead metrics - 几项代码复杂度度量。提高表示代码更复杂。</p></li><li><p>Maintainability Index - 可维护性指数。下降代表可维护性降低。</p></li><li><p>Lint Errors - Lint检查出的错误数。增加表示代码质量问题更多。</p></li><li><p>Estimated Errors - 预测出的错误数。增加表示可能出错机会上升。</p></li></ul><p>综上, Plato的指标上升通常代表代码质量和可维护性下降,复杂度提高,这可以帮助我们分析和改进代码。</p><h2 id="最终实现"><a href="#最终实现" class="headerlink" title="最终实现"></a>最终实现</h2><h3 id="Palto-报告"><a href="#Palto-报告" class="headerlink" title="Palto 报告"></a>Palto 报告</h3><p>使用 babel 解决 palto 的兼容问题。babel 将核心源码配合下面示例中的四个插件做最小程序的编译，输出到 <code>./temp/dist</code> 目录。</p><p>palto 基于 <code>./temp/dist</code> 目录的代码生成报告，输出到 <code>./reports/plato</code>。</p><p><strong><code>./scripts/plato.report.js</code>：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; execSync &#125; <span class="keyword">from</span> <span class="string">&#x27;child_process&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> plugins = [</span><br><span class="line">  <span class="string">&#x27;@babel/plugin-transform-optional-chaining&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;@babel/plugin-transform-class-properties&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;@babel/plugin-transform-private-property-in-object&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;@babel/plugin-transform-private-methods&#x27;</span>,</span><br><span class="line">].<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cmd = [</span><br><span class="line">  <span class="string">&#x27;rm -rf temp/dist ./reports/plato&#x27;</span>,</span><br><span class="line">  <span class="string">`npx babel ./bin ./lib --plugins <span class="subst">$&#123;plugins&#125;</span> --out-dir temp/dist`</span>,</span><br><span class="line">  <span class="string">&#x27;npx plato -r -d ./reports/plato ./temp/dist&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;rm -rf temp/dist&#x27;</span>,</span><br><span class="line">].<span class="title function_">join</span>(<span class="string">&#x27; &amp;&amp; &#x27;</span>);</span><br><span class="line"></span><br><span class="line">process.<span class="property">stderr</span>.<span class="title function_">write</span>(<span class="string">`<span class="subst">$&#123;cmd&#125;</span>\n`</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">execSync</span>(cmd, &#123;</span><br><span class="line">  <span class="attr">stdio</span>: <span class="string">&#x27;inherit&#x27;</span>,</span><br><span class="line">  <span class="attr">shell</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong><code>package.json</code>：</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;plato-report&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node scripts/plato.report.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><h3 id="组合-Eslint"><a href="#组合-Eslint" class="headerlink" title="组合 Eslint"></a>组合 Eslint</h3><p>简单组合 Eslint。同时生成 Eslint 与 Palto 报告。</p><p><strong><code>package.json</code>：</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;plato-report&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node scripts/plato.report.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;eslint-report&quot;</span><span class="punctuation">:</span> <span class="string">&quot;rm -rf reports/eslint-report.html &amp;&amp; npx eslint ./lib ./bin --format=html --output-file=reports/eslint-report.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;static-report&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run plato-report &amp;&amp; npm run eslint-report&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>使用 <code>npm run static-report</code> 生成两份报告。</p><h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><p>进一步加强“代码质量评估”部分的实践。增加更多的代码质量指标，比如“整体复杂度”、“圈复杂度”、“预测出的错误数”等等。</p><p>但是由于 Palto 对于 ES6+ 的语法兼容性不足，以致需要使用 Babel 做向下兼容的编译。导致报告中出现非预期的兼容性代码和报告内容，让报告的可读性下降。虽然如此，Palto 生成的报告依然比Eslint的更加详尽。</p><h1 id="依赖分析"><a href="#依赖分析" class="headerlink" title="依赖分析"></a>依赖分析</h1><p>下面将使用其他工具针对 “依赖关系分析” 部分进行实践。将列出常用几款工具做对比，然后会选择其中一款进行安装与使用。</p><h2 id="常见工具"><a href="#常见工具" class="headerlink" title="常见工具"></a>常见工具</h2><table><thead><tr><th>工具</th><th>指标</th><th>说明</th><th>GitHub Star</th></tr></thead><tbody><tr><td><a target="_blank" rel="noopener" href="https://github.com/adamtornhill/code-maat">Code Maat ↗</a></td><td>- 模块间的循环依赖关系<br>- 无效引用<br>- 模块的入度和出度<br>- 模块的内部复杂性<br>- 模块的外部复杂性<br>- 模块的深度<br>- 模块的大小</td><td>Code Maat 是一个通用的代码度量工具，支持多种指标，包括循环依赖关系、无效引用、模块的入度和出度、模块的内部复杂性、模块的外部复杂性、模块的深度和模块的大小等。它提供了灵活的配置选项和可视化功能，适用于多种编程语言。</td><td>2.2k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/sverweij/dependency-cruiser">Dependency-Cruiser ↗</a></td><td>- 可持续性指标<br>- 简单性指标<br>- 复杂性指标<br>- 规模指标</td><td>Dependency-Cruiser 提供了可持续性指标、简单性指标、复杂性指标和规模指标。可持续性指标包括模块间的循环依赖关系和无效引用。简单性指标包括模块的入度和出度、模块的内部复杂性。复杂性指标包括模块的外部复杂性和模块的深度。规模指标包括模块的大小。它提供了自定义规则和配置的功能，可用于 JavaScript 项目的依赖分析和优化。</td><td>4.4k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/webpack-bundle-analyzer">Webpack Bundle Analyzer ↗</a></td><td>- 模块大小<br>- 模块依赖关系<br>- 模块的引用路径<br>- 模块的体积占比</td><td>Webpack Bundle Analyzer 提供了模块大小、模块依赖关系、模块的引用路径和模块的体积占比等指标。它通过可视化图表和图形的方式展示这些指标，帮助你分析和优化 Webpack 打包后的代码。</td><td>12.4k</td></tr><tr><td><a target="_blank" rel="noopener" href="https://github.com/btd/rollup-plugin-visualizer">Rollup Plugin Visualizer ↗</a></td><td>- 模块大小<br>- 模块依赖关系<br>- 模块的引用路径<br>- 模块的体积占比</td><td>Rollup Plugin Visualizer 提供了模块大小、模块依赖关系、模块的引用路径和模块的体积占比等指标。它通过可视化图表和图形的方式展示这些指标，帮助你分析和优化使用 Rollup 打包后的代码。</td><td>1.5k</td></tr></tbody></table><p>Code Maat 是一个通用的代码度量工具，由于它是基于 Java 开发的，所以要在 Node.js 环境中安装和使用 Code Maat，你需要确保你的系统已经安装了 Java 运行时环境 (JRE) 或者 Java 开发工具包 (JDK)。</p><p><em>考虑到环境配置的复杂度问题，Code Maat 的优先级会下降，暂不考虑它！</em></p><p>Webpack Bundle Analyzer 是以往有使用过的一款工具，确实不错。它提供的参考指标也符合预期，流行程度也是上面 4 款中最高的，但是考虑到当前实践项目的背景（rollup），因此优先级也是往下降的。</p><p><strong>因此，就目前情况优先考虑 Rollup Plugin Visualizer 和 Dependency-Cruiser。</strong></p><details><summary><strong>预览效果</strong></summary><blockquote><img src="Dependency%20cruiser.png" alt="Dependency cruiser"> <img src="Rollup%20Plugin%20Visualizer.png" alt="Rollup Plugin Visualizer"></blockquote></details><br><p>下面将先后安装 Rollup Plugin Visualizer 和 Dependency-Cruiser，在看它们最后的实际效果。如果两者相差不大，考虑到实践项目背景，当优先选择前者。</p><h2 id="Rollup-Plugin-Visualizer"><a href="#Rollup-Plugin-Visualizer" class="headerlink" title="Rollup Plugin Visualizer"></a>Rollup Plugin Visualizer</h2><h3 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add --save-dev rollup-plugin-visualizer</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>修改 rollup 配置文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; terser &#125; <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-terser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> copy <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-copy&#x27;</span>;</span><br><span class="line">+ <span class="keyword">import</span> &#123; visualizer &#125; <span class="keyword">from</span> <span class="string">&#x27;rollup-plugin-visualizer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">input</span>: &#123;</span><br><span class="line">    <span class="attr">index</span>: <span class="string">&#x27;index.js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;bin/index&#x27;</span>: <span class="string">&#x27;bin/index.js&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">dir</span>: <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">    <span class="attr">format</span>: <span class="string">&#x27;es&#x27;</span>,</span><br><span class="line">    <span class="attr">plugins</span>: [<span class="title function_">terser</span>()]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">copy</span>(&#123;</span><br><span class="line">      <span class="attr">targets</span>: [</span><br><span class="line">        <span class="comment">// &#123; src: &#x27;assets/conf.template.yml&#x27;, dest: &#x27;dist/assets&#x27; &#125;,</span></span><br><span class="line">        &#123; <span class="attr">src</span>: [<span class="string">&#x27;package.json&#x27;</span>, <span class="string">&#x27;README.md&#x27;</span>], <span class="attr">dest</span>: <span class="string">&#x27;dist/&#x27;</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;),</span><br><span class="line">+   ...[</span><br><span class="line">+     <span class="string">&#x27;sunburst&#x27;</span>,</span><br><span class="line">+     <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">+     <span class="string">&#x27;treemap&#x27;</span>,</span><br><span class="line">+     <span class="string">&#x27;network&#x27;</span>,</span><br><span class="line">+     <span class="string">&#x27;raw-data&#x27;</span></span><br><span class="line">+   ].<span class="title function_">map</span>(<span class="function">(<span class="params">template</span>) =&gt;</span> <span class="title function_">visualizer</span>(&#123;</span><br><span class="line">+     template,</span><br><span class="line">+     <span class="attr">filename</span>: <span class="string">`reports/visualizer/<span class="subst">$&#123;template&#125;</span>.html`</span>,</span><br><span class="line">+     <span class="attr">gzipSize</span>: <span class="literal">true</span>,</span><br><span class="line">+     <span class="attr">brotliSize</span>: <span class="literal">true</span></span><br><span class="line">+   &#125;)),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>见配置文件，rollup-plugin-visualizer 提供 5 中输出样式，其中 <code>list</code> 和 <code>raw-data</code> 输出的是数据，而其他则是输出可视化图表。</p><h3 id="生成图表"><a href="#生成图表" class="headerlink" title="生成图表"></a>生成图表</h3><p>执行 <code>build</code> 脚本触发 rollup 构建。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><p>下面是生成的三种可视化的依赖图表：</p><p><code>rollup-plugin-visualizer</code> 提供了以下几种可视化图表来帮助分析 Rollup 打包的结果：</p><p><strong><code>Sunburst Chart</code>（旭日图）</strong></p><p>旭日图以圆形层级结构的方式展示模块之间的依赖关系。每个模块在图表中表示为一个扇形区域，其大小表示模块的体积或大小。模块之间的依赖关系通过扇形的嵌套关系来表示。你可以通过旭日图快速了解模块之间的依赖关系和体积占比。</p><details><summary><strong>预览效果</strong></summary><blockquote><img src="Snipaste_2023-08-30_17-35-51.png" alt="Sunburst Chart"></blockquote></details><br><p><strong><code>Treemap Chart</code>（矩形树图）</strong></p><p>矩形树图以矩形的层级结构展示模块之间的依赖关系和体积占比。每个模块在图表中表示为一个矩形，其大小表示模块的体积或大小。模块之间的依赖关系通过矩形的嵌套关系来表示。你可以通过矩形树图直观地了解模块之间的依赖关系和体积占比。</p><details><summary><strong>预览效果</strong></summary><blockquote><img src="Snipaste_2023-08-30_17-36-22.png" alt="Treemap Chart"></blockquote></details><br><p><strong><code>Network Graph</code>（网络图）</strong></p><p>网络图以节点和边的形式展示模块之间的依赖关系。每个模块在图表中表示为一个节点，模块之间的依赖关系通过边连接。你可以通过网络图观察模块之间的依赖关系和体积占比，并通过交互式操作来探索图表。</p><details><summary><strong>预览效果</strong></summary><blockquote><img src="Snipaste_2023-08-30_17-37-14.png" alt="Network Graph"></blockquote></details><br><h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><p>上面是对 Rollup Plugin Visualizer 的实践。它包含 5 种依赖分析输出格式，其中两种原始数据（list 和 raw-data），三种 HTML 可视化报告（Sunburst Chart、Treemap Chart 和 Network Graph）</p><p>HTML 可视化报告中，除了提供模块间的依赖关系信息外，每个模块还提供 Rendered （原始大小）、Gzip 算法压缩后大小 和 Brotli 算法压缩后的大小。</p><p>安装简单，无单独的配置文件。需要在 rollup 配置文件中引入，声明依赖报告的输入输出。不能单独生成报告，需要配置 rollup 打包流程使用。另外，三个可视化报告不支持一同输出到同一个 HTML 文件，相互独立。</p><h2 id="Dependency-cruiser"><a href="#Dependency-cruiser" class="headerlink" title="Dependency cruiser"></a>Dependency cruiser</h2><h3 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h3><p>安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add --save-dev dependency-cruiser</span><br></pre></td></tr></table></figure><p>初始化，将在当前目录下生成 <code>.dependency-cruiser.cjs</code> 文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx depcruise --init</span><br></pre></td></tr></table></figure><p><img src="dependency-cruiser_init.gif" alt="dependency-cruiser init"></p><h3 id="生成报告"><a href="#生成报告" class="headerlink" title="生成报告"></a>生成报告</h3><p>根据README的指引，可以使用以下命令生成依赖报告：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx depcruise src --include-only &quot;^src&quot; --output-type dot \</span><br><span class="line">  | dot -T svg \</span><br><span class="line"><span class="meta prompt_">  &gt; </span><span class="language-bash">dependency-graph.svg</span></span><br></pre></td></tr></table></figure><ul><li><p><code>--include-only &quot;^src&quot;</code>: <code>--include-only</code> 参数用于指定只包括满足特定正则表达式的文件或目录。在这个命令中，它指定只包括以 <code>src</code> 开头的文件或目录。</p></li><li><p><code>--output-type dot</code>: <code>--output-type</code> 参数用于指定生成的输出类型。在这个命令中，它指定生成 DOT 格式的输出。</p></li><li><p><code>dot -T svg</code>: <code>dot</code> 是 GraphViz 工具包中的一部分，用于将 DOT 格式的输入转换为不同的图形输出格式。<code>-T svg</code> 参数指定将输出转换为 SVG 格式。</p></li><li><p><code>&gt; dependency-graph.svg</code>: <code>&gt;</code> 是重定向操作符，用于将命令的输出重定向到一个文件。在这个命令中，它将生成的 SVG 图形输出重定向到名为 <code>dependency-graph.svg</code> 的文件。</p></li></ul><p><code>dot</code> 是 GraphViz 工具包中的一部分，因此需要安装相关的工具，<code>graphviz</code>。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line">sudo apt install graphviz -y</span><br></pre></td></tr></table></figure><p>准备工作完成，下面根据上面的指引略作修改，然后生成报告：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx depcruise bin --output-type dot \</span><br><span class="line">  | dot -T svg \</span><br><span class="line"><span class="meta prompt_">  &gt; </span><span class="language-bash">dependency-graph.svg</span></span><br></pre></td></tr></table></figure><details><summary><strong>预览效果</strong></summary><blockquote><img src="Snipaste_2023-08-30_20-27-01.png" alt></blockquote></details><br><p>生成交互性更强的报告：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npx depcruise -v -T dot bin \</span><br><span class="line">  | dot -T svg \</span><br><span class="line">  | npx depcruise-wrap-stream-in-html \</span><br><span class="line"><span class="meta prompt_">  &gt; </span><span class="language-bash">dependency-graph.html</span></span><br></pre></td></tr></table></figure><details><summary><strong>预览效果</strong></summary><blockquote><img src="Snipaste_2023-08-30_20-37-11.png" alt></blockquote></details><br><p><em>上面两种方式生成的报告都依赖系统软件 <code>graphviz</code>，在特定情况下，或许无法安装。下面介绍无需系统软件便可生成的方式。</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dependency-cruise -T html -f dependencies.html bin</span><br></pre></td></tr></table></figure><details><summary><strong>预览效果</strong></summary><blockquote><img src="Snipaste_2023-08-31_15-30-56.png" alt></blockquote></details><br><p>除了上面实践的 3 种报告外，Dependency cruiser 还支持更多的报告输出方式，想要了解更多可查阅：<a target="_blank" rel="noopener" href="https://github.com/sverweij/dependency-cruiser/blob/main/doc/cli.md">dependency-cruiser command line interface</a>。</p><h3 id="集成到-IDE"><a href="#集成到-IDE" class="headerlink" title="集成到 IDE"></a>集成到 IDE</h3><p>Dependency cruiser 除了可以通过 CLI 生成报告外，还可以集成到 VS Code。见下：</p><p><img src="Snipaste_2023-08-31_15-55-07.png" alt="Dependency Cruiser Extension"></p><p>Extension ID：<code>juanallo.vscode-dependency-cruiser</code></p><details><summary><strong>预览效果</strong></summary><blockquote><img src="Snipaste_2023-08-31_15-58-54.png" alt></blockquote></details><br><h3 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h3><p>上面做了 Dependency cruiser 的实践。生成报告前需要初始化配置文件。实践了 3 种报告，其中 2 种需要依赖系统软件 graphviz，1 种不需要。前 2 种类似，区别在于可交互性（可高亮模块的引入路线），相较后面 1 种可读性强。</p><p>Dependency cruiser 支持配置文件，可配置多种规则和报告输出格式，除了上面实践的三种外，还支持很多，大部分依赖系统软件，或需要特定应用层级软件查看，更多信息可查阅 <a target="_blank" rel="noopener" href="https://github.com/sverweij/dependency-cruiser/blob/main/doc/cli.md">dependency-cruiser command line interface</a>。</p><p>Dependency cruiser 除了支持 CLI 单独生成依赖报告外，还支持集成到 IDE（VS Code），可以查阅单个模块的依赖上下文，生成的报告支持在 VS CODE 跳转到相应模块文件。</p><p>Dependency cruiser 提供多种样式与格式的依赖图，可读性强。它专注于依赖关系的描述，无其他更多信息提供，比如模块大小，压缩后大小等等。</p><h2 id="最终实现-1"><a href="#最终实现-1" class="headerlink" title="最终实现"></a>最终实现</h2><p>从上面 rollup-plugin-visualizer 与 Dependency cruiser 的实践中发现，相比前者，后者的可读性更强，如果单纯追求可视化依赖关系，Dependency cruiser 是不二之选。可惜 Dependency cruiser 仅仅如此，若果可以展示模块大小等等数据会更优，而这是 rollup-plugin-visualizer 相对它的优势。</p><p><em>因此何不将两者结合，毕竟它们是开发的辅助工具，它们臃肿与否不影响最终源码体积。</em></p><p>上面对 rollup-plugin-visualizer 的最终实现已经说明，不做赘述，下面说明 Dependency cruiser 的最终实现并将两者结合。</p><p>首先，生成交互性更强的报告，输出到与 rollup-plugin-visualizer 相同的报告目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npx depcruise -v -T dot bin \</span><br><span class="line">  | dot -T svg \</span><br><span class="line">  | npx depcruise-wrap-stream-in-html \</span><br><span class="line"><span class="meta prompt_">  &gt; </span><span class="language-bash">reports/visualizer/dependency.html</span></span><br></pre></td></tr></table></figure><p>将此命令与 rollup 的 build 关联到一起：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;dependency-report&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npx depcruise -v -T dot bin | dot -T svg | npx depcruise-wrap-stream-in-html &gt; reports/visualizer/dependency.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node ./scripts/build.js &amp;&amp; npm run dependency-report&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><p>如此这边，只有运行 <code>npm run build</code>，即可生成以上 rollup-plugin-visualizer 与 Dependency cruiser 的 4 个依赖报告。</p><p>为方便查看，当增加入口查看这 4 个报告。添加一个简单的 <code>index.html</code> 文件到 <code>reports/visualizer/</code> 目录下，通过 <code>iframe</code> 引入 4 个报告的 html 文件。</p><details><summary><strong>reports/visualizer/index.html</strong></summary><pre><code class="lang-html"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>visualizer<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> &#123;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    &#125;
    <span class="hljs-selector-tag">body</span> &#123;
      <span class="hljs-attribute">margin</span>: auto;
    &#125;
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> getViewportSize = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    <span class="hljs-keyword">const</span> width = <span class="hljs-built_in">window</span>.innerWidth || <span class="hljs-built_in">document</span>.documentElement.clientWidth || <span class="hljs-built_in">document</span>.body.clientWidth;
    <span class="hljs-keyword">const</span> height = <span class="hljs-built_in">window</span>.innerHeight || <span class="hljs-built_in">document</span>.documentElement.clientHeight || <span class="hljs-built_in">document</span>.body.clientHeight;
    <span class="hljs-keyword">return</span> &#123;
      width,
      height
    &#125;;
  &#125;;
  <span class="hljs-keyword">const</span> insertIframeAfterPageLoad = <span class="hljs-function">(<span class="hljs-params">&#123; title, src, width, height &#125;</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">const</span> iframe = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'iframe'</span>);
    iframe.title = title;
    iframe.src = src;
    iframe.width = <span class="hljs-built_in">Math</span>.ceil(width);
    iframe.height = <span class="hljs-built_in">Math</span>.ceil(height);
    iframe.style = <span class="hljs-string">"border:none;"</span>;
    <span class="hljs-built_in">document</span>.body.appendChild(iframe);
  &#125;;<br>
  <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'load'</span>, () =&gt; &#123;
    <span class="hljs-keyword">const</span> viewportSize = getViewportSize();
    <span class="hljs-keyword">let</span> size = viewportSize.width / <span class="hljs-number">2</span> - <span class="hljs-number">10</span>;
    insertIframeAfterPageLoad(&#123;
      <span class="hljs-attr">src</span>: <span class="hljs-string">'./network.html'</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'network'</span>,
      <span class="hljs-attr">width</span>: size,
      <span class="hljs-attr">height</span>: size,
    &#125;);<br>
    insertIframeAfterPageLoad(&#123;
      <span class="hljs-attr">src</span>: <span class="hljs-string">'./sunburst.html'</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'sunburst'</span>,
      <span class="hljs-attr">width</span>: size,
      <span class="hljs-attr">height</span>: size,
    &#125;);<br>
    insertIframeAfterPageLoad(&#123;
      <span class="hljs-attr">src</span>: <span class="hljs-string">'./dependency.html'</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'dependency'</span>,
      <span class="hljs-attr">width</span>: size,
      <span class="hljs-attr">height</span>: size,
    &#125;);<br>
    insertIframeAfterPageLoad(&#123;
      <span class="hljs-attr">src</span>: <span class="hljs-string">'./treemap.html'</span>,
      <span class="hljs-attr">title</span>: <span class="hljs-string">'treemap'</span>,
      <span class="hljs-attr">width</span>: size,
      <span class="hljs-attr">height</span>: size,
    &#125;);
  &#125;);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre></details><br><details><summary><strong>预览效果</strong></summary><blockquote><img src="Snipaste_2023-08-31_19-11-09.png" alt></blockquote></details><br><h2 id="小结-4"><a href="#小结-4" class="headerlink" title="小结"></a>小结</h2><p>以上是对依赖分析的实践。挑选了常见的分析工具（Code Maat、Dependency-Cruiser、Webpack Bundle Analyzer 和 Rollup Plugin Visualizer）对比，结合实际请款，选择 Dependency-Cruiser 和 Rollup Plugin Visualizer 作为实践内容。分别先后安装 Rollup Plugin Visualizer 和 Dependency-Cruiser。</p><p>Rollup Plugin Visualizer 是 rollup 常见，需要配置 rollup 的打包流程使用。它支持 Sunburst Chart、Treemap Chart 和 Network Graph 3 种可视化报告，除了依赖关系信息外，还提供压缩与原始的模块大小信息。</p><p>Dependency-Cruiser 单纯提供依赖关系信息，支持多种样式报告，但多依赖系统软件。它生成的报告，在模块依赖关系的信息方面比起 Rollup Plugin Visualizer 更强。</p><p>鉴于 Rollup Plugin Visualizer 与 Dependency-Cruiser 有一定的互补关系，在实践中，选择同时生成它们的报告，总共 4 个可视化的报告，为方便对比查看，通过 iframe 将它们缝合到一个 HTML 文件中。</p><p>下面回顾 <a href="#%E5%86%85%E5%AE%B9%E6%9E%84%E6%88%90">内容构成</a> 中提到的一系列实践内容：</p><ul><li><input checked disabled type="checkbox"> 语法检查</li><li><input checked disabled type="checkbox"> 代码规范检查</li><li><input checked disabled type="checkbox"> 代码质量评估</li><li><input checked disabled type="checkbox"> 依赖关系分析</li><li><input disabled type="checkbox"> 安全漏洞检测</li><li><input disabled type="checkbox"> 性能优化建议</li><li><input disabled type="checkbox"> 异步代码分析</li><li><input disabled type="checkbox"> 可读性和一致性评估</li></ul><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a target="_blank" rel="noopener" href="https://juejin.cn/post/7096650413209813029">治理项目模块依赖关系，试试这艘「依赖巡洋舰」</a></li></ul></div><footer class="post-footer"><div class="reward-container"><div>Buy me a coffee</div><button>赞赏</button><div class="post-reward"><div><img src="/blog/images/wechatpay.jpg" alt="Isaac Kam 微信"> <span>微信</span></div><div><img src="/blog/images/alipay.jpg" alt="Isaac Kam 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>Isaac Kam</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://isaaxite.github.io/blog/resources/Static-code-analysis/" title="Static code analysis">https://isaaxite.github.io/blog/resources/Static-code-analysis/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><span>欢迎关注我的其它发布渠道</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="https://www.zhihu.com/people/issac-79"><span class="icon"><i class="fab | fa-zhihu"></i> </span><span class="label">Zhihu</span></a></div><div class="social-item"><span class="social-link"><span class="icon"><i class="fab fa-weixin"></i> </span><span class="label">WeChat</span> </span><img class="social-item-img" src="/blog/images/wechat_qrcode.jpg"></div><div class="social-item"><a target="_blank" class="social-link" href="/blog/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="https://github.com/isaaxite"><span class="icon"><i class="fab fa-github"></i> </span><span class="label">GitHub</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="isaacgun:isaacgun@outlook.com"><span class="icon"><i class="fa fa-envelope"></i> </span><span class="label">E-Mail</span></a></div></div></div><div class="post-tags"><a href="/blog/tags/writting/" rel="tag"><i class="fa fa-tag"></i> writting</a></div><div class="post-nav"><div class="post-nav-item"><a href="/blog/resources/Get-Start-Of-Github-Action/" rel="prev" title="Github Action 入门指南"><i class="fa fa-chevron-left"></i> Github Action 入门指南</a></div><div class="post-nav-item"><a href="/blog/resources/Practice-of-lerna/" rel="next" title="Practice of lerna">Practice of lerna <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Isaac Kam</span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script><script src="/blog/js/comments.js"></script><script src="/blog/js/utils.js"></script><script src="/blog/js/motion.js"></script><script src="/blog/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/blog/js/third-party/search/local-search.js"></script><script src="/blog/js/third-party/fancybox.js"></script><script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"isaaxite/blog","issue_term":"title","theme":"github-light"}</script><script src="/blog/js/third-party/comments/utterances.js"></script></body></html>