---
title: Static code analysis
excerpt: Static code analysis
date: 2023-08-21 11:08:54
tags:
  - writting
categories:
---


# 摘要



# 静态代码分析

静态代码分析指的是在不实际执行代码的情况下，对源代码进行分析，并识别潜在问题、漏洞或代码质量违规。它是在持续集成和持续部署（CI/CD）流程中进行代码分析的自动化方法。

静态代码分析工具会检查各种编程语言的源代码，检查常见的编码错误、安全漏洞、遵循编码规范和其他最佳实践。这些工具可以检测语法错误、未使用的变量、代码重复、潜在的安全漏洞以及遵循编码风格指南等问题。

通过将静态代码分析集成到 CI/CD 流程中，开发人员可以及早发现并解决代码问题。这有助于提高代码质量、可维护性和安全性，通过在代码进入生产环境之前识别和修复问题。


# 实践的内容

静态代码分析的实践主要包括以下几个部分:

- 配置分析工具：选择合适的静态分析工具,如ESLint、JSLint等,并进行必要的配置,启用需要的规则、设置范围等。

- 整合到构建流程：将静态分析工具集成到持续集成的构建流程和commit阶段,以自动化分析和检查。

- 定义规则：根据代码规范需求,定制适合项目的分析规则,如代码样式、错误处理等规则。

- 忽略部分代码：使用注释或配置来忽略一些第三方代码的分析。

- 审查警告和错误：检查静态分析工具报告的问题,区分错误和警告的严重程度。

- 修复问题：根据报告来修复代码中的问题,消除错误或者警告。

- 提交验证：在提交代码前,确保静态分析没有错误,验证所有问题都已修复。

- 持续监控：持续观察静态分析报告,发现问题及早修复,保持代码质量。

- 优化配置：根据反馈持续优化分析配置,找到最佳实践。


**其中”修复问题“、”持续监控“和”优化配置“是后续操作，前置需要搭建的则是剩余的6点：**

1. 配置分析工具；

2. 定义规则；

3. 忽略部分代码；

4. 审查警告和错误；

5. 提交验证；

6. 整合到构建流程。

<!-- 0. 定义代码规范和规则

1. 发现问题和反馈

开发过程中，提示非法的编写方式。

2. 强制执行；

代码提交前，检验不通过将被中断

3. 自动格式化；

这是在第二部的基础上的加强，检验不通过将被自动格式化。

4. 质量报告生成 -->

# 分析工具 

## 常见工具

| 工具                                            | 描述                                                                                | 提出时间  | GitHub Star 数量 |
| ----------------------------------------------- | --------------------------------------------------------------------------------- | ----- | -------------- |
| [ESLint](https://eslint.org/)                   | 可配置的 JavaScript/JS 代码检查工具和静态分析器，替代 JSHint，提供更大的灵活性和可配置性                           | 2013年 | 23.3k          |
| [JSHint](https://jshint.com/)                   | JavaScript/JS 的静态代码分析工具，支持可定制的规则，延续 JSLint 的思想，提供更好的可定制性和适应性                      | 2011年 | 8.9k           |
| [TSLint](https://palantir.github.io/tslint/)    | 针对 TypeScript 的静态代码分析工具，已被 ESLint 取代，提供静态代码检查和规范性的支持                              | 2012年 | 5.9k              |
| [TypeScript](https://www.typescriptlang.org/)   | JavaScript 的超集，带有静态类型检查和编译时静态代码分析能力，提供更严格的类型检查和更好的 IDE 支持，增强 JavaScript 开发环境的可靠性  | 2012年 | 93.5k          |
| [Flow](https://flow.org/)                       | Facebook 开发的 JavaScript/JS 静态类型检查器，为 JavaScript 开发者提供静态类型检查，提高代码质量和可维护性           | 2014年 | 22k          |

从功能性与和流行趋势，TSLint 和 JSHint 已经被 ESLint 替代。而 TypeScript，与其说它是静态代码分析的工具，不如说它是个类似JS的语言。当然它具备静态代码分析的能力，但如果已经开发到一定程度的项目所使用的开发语言是JS的话，使用TS的会有不小的迁移成本！

剩下的是 ESLint 和 Flow，它们提出时间和流行程度都差不多。不妨针对它们做一下对比分析。

下面是使用表格对比 ESLint 和 Flow 的功能：

| 功能            | ESLint                                    | Flow                                 |
| ------------- | ----------------------------------------- | ------------------------------------ |
| 代码检查          | ✔️                                        | ✔️                                   |
| 类型检查          | ❌                                         | ✔️                                   |
| 静态类型推断        | ❌                                         | ✔️                                   |
| 编译时类型检查       | ❌                                         | ✔️                                   |
| 支持 JavaScript | ✔️                                        | ✔️                                   |
| 支持 TypeScript | ✔️                                        | ❌                                    |
| 可配置性          | 高                                         | 中                                    |
| 社区支持          | 大型活跃社区，广泛的插件和扩展库可用                        | 较小的社区，插件和扩展库相对较少                     |
| IDE 集成        | 广泛支持，与许多主流编辑器（如 VS Code、Sublime Text）集成良好 | 有限的 IDE 集成，可能不如 ESLint 的支持广泛和完善      |
| 项目可移植性        | 高                                         | 较低，Flow 的类型注释和配置文件需要进行迁移和调整才能与其他工具兼容 |

需要注意的是，ESLint 和 Flow 在某些功能上有所重叠，但也有一些区别。ESLint 主要关注代码规范和质量检查，而 Flow 则专注于静态类型检查和类型推断。ESLint 的可配置性和社区支持相对较高，适用于 JavaScript 和 TypeScript 项目，并与各种编辑器集成良好。Flow 在类型检查和静态类型推断方面表现出色，但它的社区支持相对较小，与编辑器的集成程度可能不如 ESLint 那么广泛。此外，如果要将项目从 Flow 迁移到其他工具或框架，可能需要进行一些调整和改动。


## ESLint

ESLint 是一个用于检查和规范 JavaScript 代码的开源工具。它可以帮助开发者在编写代码时发现潜在的问题、遵循一致的代码风格，并提供自定义的代码规则。ESLint 具有高度可配置性和灵活性，可以适应不同项目和团队的需求。

以下是 ESLint 的一些主要特点和功能：

1. 代码规范检查： ESLint 可以静态地分析 JavaScript 代码，并根据预定义的规则集检查代码是否符合规范。它可以发现常见的错误、潜在的问题和不一致之处，如未声明的变量、使用未定义的函数、潜在的歧义等。

2. 可配置性： ESLint 具有高度的可配置性，允许开发者根据项目需求和团队的代码风格指南自定义规则。你可以启用、禁用或修改规则，并设置不同的错误级别（警告或错误）。此外，ESLint 还支持配置文件的继承和共享，以便在多个项目中共享和重用配置。

3. 插件和扩展： ESLint 具有丰富的插件生态系统，可以通过插件扩展其功能。插件可以添加额外的规则、支持其他文件类型（如 TypeScript、Vue 等），或提供特定框架或库的规则集。通过安装和配置这些插件，你可以在 ESLint 中使用更多的规则和功能。

4. 自动修复问题： ESLint 具备自动修复问题的能力，可以通过 --fix 标志自动修复一些常见的问题，如不一致的缩进、缺少分号等。这样可以减轻开发者手动修复问题的负担，并提高代码的一致性。

5. 与编辑器和构建工具的集成： ESLint 可以与各种编辑器和构建工具集成，以提供实时的代码检查和反馈。大多数编辑器都支持 ESLint 插件，可以在保存文件时自动运行 ESLint，并在编辑器中显示错误和警告。此外，ESLint 还可以与构建工具（如 webpack、gulp 等）集成，以便在构建过程中进行代码检查。

ESLint 是一个非常强大和流行的工具，被广泛用于 JavaScript 项目中。它可以帮助开发团队保持一致的代码风格、规范代码质量，并提高代码的可读性和可维护性。通过使用 ESLint，开发者可以在早期发现和解决潜在的问题，提高代码的可靠性和稳定性。

